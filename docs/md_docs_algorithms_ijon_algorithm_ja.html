<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fuzzuf: IJON</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fuzzuf
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">IJON </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md102"></a>
IJONとは</h1>
<p><a href="https://github.com/RUB-SysSec/ijon/">IJON</a>[^ijon]は、<a href="https://informatik.rub.de/syssec/">SysSec</a>によって提案された、PUTがファザーに新しいフィードバックを返せるようにするアノテーション手法、およびそれらのフィードバックに対応したファザーです。有名なファザーの多くは、PUTからコードカバレッジをフィードバックとして受け取ることでプログラムの新しい挙動を見つけようとする、カバレッジガイデッドファザーに種別されます。典型的なカバレッジガイデッドファザーには以下のような弱点があります:</p>
<ul>
<li>コードカバレッジがどのような順序によって獲得されたかについて気にしていない。例えば、「関数Aが実行された直後に関数Bが実行されること」が引き起こす条件となっているようなバグがあったとする。ファザーは、バグを引き起こす入力と「関数Bの実行の後に関数Aの実行を引き起こすような入力」を区別できないため、後者のみを試してしまい、バグを見落とす可能性がある。より突き詰めていえば、そもそも「関数Aと関数Bの両方を通らせる入力」と「関数Aを通らせる入力および関数Bを通らせる入力の２つ」を区別できず、どちらか一方を既に試している場合には、もう一方を試さないようなアルゴリズムが多い。<ul>
<li>コードカバレッジの種類の中で、パスカバレッジを用いた場合には、この問題にはある程度対処できる。しかし、実行パスが異なる入力を過剰に保存してしまった場合には、同じファジング結果になる似たような入力を保持しやすくなり、ファジングキャンペーン全体の効率が低下してしまうというトレードオフがある。このトレードオフを自動で良い塩梅に調節するというのは難しい。</li>
</ul>
</li>
<li>コードカバレッジでは気づくことのできない内部状態の変化が存在しうる。例えば、IJONの論文に記載されている通り、ゲームにおけるプレイヤーの座標などを考えてみると分かりやすい。プレイヤーが画面上のどの位置に存在しているかは、ゲームの新しい状態を発見する上で重要になる可能性が高い。プレイヤーが画面右下にいるよりも画面左上にいるほうが、新しいイベントの発生座標に近いかもしれない。しかしながら、コードカバレッジだけをフィードバックとしている場合は、どちらの座標にいても同じフィードバックが返されることになる。</li>
</ul>
<p>IJONは、これらの問題点に対処できるシンプルな解決策として、「PUTに対して人の手でアノテーションを行う」という方法を提案しています。PUTをソースコードからビルドしカバレッジの取得を計装する際、人間がソースコードにアノテーションを加えることで、PUTがファザーに与えるフィードバックをカスタマイズできます。IJONが提供するアノテーションには様々なものがあり、人間が重要な内部状態だと考えるものを明示するために用います。例えば「ある変数の最大値をフィードバックに記録する」、「ある2変数の差の最小値を記録する」といったアノテーションが可能です。</p>
<p>実際には、IJONのファザーはAFLをベースとして実装されているため、PUTが返すフィードバックは、(Hashed) Edge Coverageであり、共有メモリを経由してファザーに受け渡されます。したがって、IJONは、ソースコードに記述できるアノテーションを、具体的には共有メモリに対して値を書き込む関数およびマクロとして実装しています。これらのマクロや関数は、計装ツールがEdge Coverageを計装する際に、一緒にコンパイルされます。</p>
<p>このようにIJONは、AFLベースかつ実用的なファジングにおいて求められるハーネス記述用のインターフェイスを備えており、fuzzufの応用可能性の向上を目的としてfuzzuf上に実装されています。</p>
<h1><a class="anchor" id="autotoc_md103"></a>
CLI上での使用方法</h1>
<p>IJONのファザーを利用するには、まず、計装ツールを用いてアノテーションをほどこしたPUTを準備する必要があります。 fuzzufには計装ツールが存在していないため、<a href="https://github.com/RUB-SysSec/ijon/">IJONのリポジトリ</a>からオリジナルの計装ツールをビルドしてください。</p>
<p>IJONのファザーは、ビルドした計装ツールによってPUTを作成した後、<code>fuzzuf</code>をインストールした状態で、</p>
<div class="fragment"><div class="line">fuzzuf ijon -i path/to/initial/seeds/ path/to/PUT @@</div>
</div><!-- fragment --><p>で起動できます。指定可能なグローバルなオプションはAFLと同様です。 AFLのオプションについては<a href="/docs/algorithms/afl/algorithm_ja.md#cli上での使用方法">AFL/algorithm_ja.md#cli上での使用方法</a>を参照してください。</p>
<p>使用できるIJONのローカルオプションは以下です:</p>
<ul>
<li><code>--forksrv 0|1</code><ul>
<li>1が指定された場合、fork server modeが有効になります。 デフォルトで有効です。</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md104"></a>
使用例</h1>
<p>ビルドした計装ツールおよびfuzzufに実装されたIJONのファザーをテストする簡単な方法は、IJONのリポジトリにある<a href="https://github.com/RUB-SysSec/ijon/blob/master/test.c">test.c</a>および<a href="https://github.com/RUB-SysSec/ijon/blob/master/test2.c">test2.c</a>をビルドし、ファジングしてみることです。ただし、test.cは、現在の最新コミット(56ebfe34)では正常にビルドできないため、以下の変更を加えてください。</p>
<div class="fragment"><div class="line">diff --git a/llvm_mode/afl-rt.h b/llvm_mode/afl-rt.h</div>
<div class="line">index 616cbd8..28d5f9d 100644</div>
<div class="line">--- a/llvm_mode/afl-rt.h</div>
<div class="line">+++ b/llvm_mode/afl-rt.h</div>
<div class="line">@@ -45,14 +45,14 @@ void ijon_enable_feedback();</div>
<div class="line"> void ijon_disable_feedback();</div>
<div class="line"> </div>
<div class="line"> #define _IJON_CONCAT(x, y) x##y</div>
<div class="line">-#define _IJON_UNIQ_NAME() IJON_CONCAT(temp,__LINE__)</div>
<div class="line">+#define _IJON_UNIQ_NAME IJON_CONCAT(temp,__LINE__)</div>
<div class="line"> #define _IJON_ABS_DIST(x,y) ((x)&lt;(y) ? (y)-(x) : (x)-(y))</div>
<div class="line"> </div>
<div class="line"> #define IJON_BITS(x) ((x==0)?{0}:__builtin_clz(x))</div>
<div class="line"> #define IJON_INC(x) ijon_map_inc(ijon_hashstr(__LINE__,__FILE__)^(x))</div>
<div class="line"> #define IJON_SET(x) ijon_map_set(ijon_hashstr(__LINE__,__FILE__)^(x))</div>
<div class="line"> </div>
<div class="line">-#define IJON_CTX(x) ({ uint32_t hash = hashstr(__LINE__,__FILE__); ijon_xor_state(hash); __typeof__(x) IJON_UNIQ_NAME() = (x); ijon_xor_state(hash); IJON_UNIQ_NAME(); })</div>
<div class="line">+#define IJON_CTX(x) ({ uint32_t hash = ijon_hashstr(__LINE__,__FILE__); ijon_xor_state(hash); __typeof__(x) IJON_UNIQ_NAME = (x); ijon_xor_state(hash); IJON_UNIQ_NAME; })</div>
<div class="line"> </div>
<div class="line"> #define IJON_MAX(x) ijon_max(ijon_hashstr(__LINE__,__FILE__),(x))</div>
<div class="line"> #define IJON_MIN(x) ijon_max(ijon_hashstr(__LINE__,__FILE__),0xffffffffffffffff-(x))</div>
<div class="line">diff --git a/test.c b/test.c</div>
<div class="line">index 50b1b05..aa022f6 100644</div>
<div class="line">--- a/test.c</div>
<div class="line">+++ b/test.c</div>
<div class="line">@@ -3,6 +3,7 @@</div>
<div class="line"> #include&lt;assert.h&gt;</div>
<div class="line"> #include&lt;stdbool.h&gt;</div>
<div class="line"> #include &lt;stdlib.h&gt;</div>
<div class="line">+#include &lt;stdint.h&gt;</div>
<div class="line"> </div>
<div class="line"> #define compare(x,y) IJON_CTX(compare_w((x),(y)))</div>
<div class="line"> bool compare_w(int x, int y){</div>
</div><!-- fragment --><p>例えば、test.cをビルドしたバイナリは、以下のようにしてファジングできます:</p>
<div class="fragment"><div class="line">$ (path_to_ijon)/afl-clang-fast (path_to_ijon)/test.c -o test</div>
<div class="line">$ mkdir /tmp/ijon_test_indir/ &amp;&amp; echo hello &gt; /tmp/ijon_test_indir/hello</div>
<div class="line">$ fuzzuf ijon -i /tmp/ijon_test_indir/ ./test</div>
</div><!-- fragment --><p>test.cは標準入力から入力を受け付けるため、&lt;tt&gt;@@を指定する必要がないことに注意してください。IJONの計装ツールおよびファザーが正常に機能している場合、高い確率で3分から5分程度の間にクラッシュが発見されます。</p>
<p>test.cおよびtest2.cを見れば、アノテーションの付け方のイメージを掴むことができますが、 より詳しいアノテーションの使い方については、IJONのREADMEおよびソースコードを参照してください。</p>
<h1><a class="anchor" id="autotoc_md105"></a>
アルゴリズム概要</h1>
<p>IJONはAFLの処理をほとんど残したまま、処理を追加する形で実装されています。大まかには、AFLとの差分は以下のとおりです:</p>
<ul>
<li>havocミューテーションのいくつかのケースが改変されている。</li>
<li>AFLのシードキューとは別に、IJON専用のシードキューを持つ。<ul>
<li>共有メモリ上の64bit非負整数の配列のそれぞれの要素について、IJONのシードキューは「その要素へ最も大きい値を記録したシード」を保存する。</li>
</ul>
</li>
<li>ファジングループの冒頭で、ランダムに処理の分岐が発生する。<ul>
<li>80の確率でIJONのシードキューからシードが選択される。この場合、直後にhavocステージに移行し、havocミューテーションを一定回数行うとファジングループの先頭に戻る。</li>
<li>20の確率でAFLのシードキューからシードが選択される。この場合は、元のAFLと同じ流れでミューテーションを行う。</li>
</ul>
</li>
<li>PUT実行後の、PUTから得られたフィードバックを元にしたシードキューの更新で、IJONのシードキューも更新する。<ul>
<li>20の確率でAFLが選択された場合でも、IJONのシードキューは更新する。</li>
</ul>
</li>
<li>定数の値がいくつか変更されている。</li>
</ul>
<h1><a class="anchor" id="autotoc_md106"></a>
参考文献</h1>
<p>[^ijon]: C. Aschermann, S. Schumilo, A. Abbasi, and T. Holz. 2020. IJON: Exploring Deep State Spaces via Fuzzing. In Proceedings of the 41st IEEE Symposium on Security and Privacy (S&amp;P’20). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
