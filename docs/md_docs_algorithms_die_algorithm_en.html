<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fuzzuf: DIE</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fuzzuf
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">DIE </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md45"></a>
About DIE</h1>
<p><a href="https://github.com/sslab-gatech/DIE/">DIE</a>[^die] is a fuzzer developed by <a href="https://gts3.org/">SSLab</a> to find bugs in JavaScript engines. Generally speaking, there are several problems in fuzzing JavaScript engines:</p>
<ul>
<li>The fuzzer needs to generate syntactically correct JavaScript test cases.</li>
<li>The fuzzer wants to generate JavaScript test cases that run without runtime errors.<ul>
<li>Ordinal fuzzers enclose every statement with try-catch to avoid the scripts from stopping by runtime errors</li>
<li>However, the JIT compiler doesn't optimize functions including try-catch statement, which decreases the amount of bugs found in the JIT engine.</li>
</ul>
</li>
</ul>
<p>State-of-the-Art fuzzers such as <a href="https://github.com/googleprojectzero/fuzzilli">fuzzilli</a> address these obstacles. DIE, as well as fuzzilli, does not only resolve the problems but also has a feature called aspect-preserving.</p>
<p>The intention of DIE is to give "finding bugs similar to the past bugs" priority. Therefore, it mutates JavaScript test cases with keeping its basic structure such as function calls or for-statements. In this way, DIE is likely to be able to preserve the "aspect" of the original test cases through the mutation process.</p>
<p>DIE mode is available on fuzzuf as an example implementation of a fuzzer to take advantages of an external mutation engine.</p>
<h1><a class="anchor" id="autotoc_md46"></a>
Usage on CLI</h1>
<h2><a class="anchor" id="autotoc_md47"></a>
Requirements</h2>
<p>DIE requires the following tools (Tested on Ubuntu 14.04/18.04/20.04):</p>
<ul>
<li><a href="https://nodejs.org/en/download/">Node.js</a> (Tested on 16.13 LTS at Jan 17th, 2022)<ul>
<li>npm (6 or later is recommended)</li>
<li>node (10 or later is recommended)</li>
</ul>
</li>
<li>Python 3 (3.6 or later is recommended)</li>
</ul>
<h2><a class="anchor" id="autotoc_md48"></a>
Automated Setup</h2>
<p>A bash script to setup DIE is available in fuzzuf. Run the following command after building fuzzuf to setup DIE.</p>
<div class="fragment"><div class="line">cmake --build build --target die</div>
</div><!-- fragment --><p>If the following message shows up after running the command above, the installation is successful. Jump to the section "Preparing Seeds." </p><div class="fragment"><div class="line">[+] DIE successfully setup!</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md49"></a>
Manual Setup</h2>
<p>If you don't choose to use the automated setup for some reason, follow the next steps to manually setup DIE.</p>
<p>First of all, clone DIE from the official repository. We've tested with the latest commit <code>f1ab180c18ea4096d6c3336a7dc3e00af897549d</code> at Jan 17th, 2022. </p><div class="fragment"><div class="line">git clone https://github.com/sslab-gatech/DIE/</div>
</div><!-- fragment --><p>Then install the required packages. </p><div class="fragment"><div class="line">cd DIE/fuzz/TS</div>
<div class="line">npm install</div>
</div><!-- fragment --><p>You also need to transpile TypeScript into JavaScript. </p><div class="fragment"><div class="line">node_module/.bin/tsc</div>
</div><!-- fragment --><p>Now you finished everything required to use DIE mode of fuzzuf.</p>
<h2><a class="anchor" id="autotoc_md50"></a>
Preparing Seeds</h2>
<p>DIE requires initial seeds to be mutated. The seeds must be JavaScript files that have extension <code>.js</code> and one or more seeds are necessary. Because of the nature of DIE, it's desirable to use Proof-of-Concepts of the bugs found in the past as test cases. The seed set used in the original paper of DIE is <a href="https://github.com/sslab-gatech/DIE-corpus">published in GitHub</a>.</p>
<p>The JavaScript files in the seed directory are instrumented before starting the fuzzing loop and the type information is collected. Those type infomation is saved to a file with the extension <code>.t</code>. If this file exists, fuzzuf skips to collect type information for the test case when fuzzing is rerun in the future. (Therefore, you need to delete the files with the extension <code>.t</code> if you change the contents of test cases in the seed directory.)</p>
<h2><a class="anchor" id="autotoc_md51"></a>
Fuzzing with DIE</h2>
<p>You can use DIE mode with the following command, for example:</p>
<div class="fragment"><div class="line">fuzzuf die --in_dir=input --out_dir=output -- ./target/d8 @@</div>
</div><!-- fragment --><p>In the example above, <code>./target/d8</code> is the PUT to be fuzzed. You must prepare one or more JavaScript files in the directory specified by <code>--in_dir</code>. Also, you have to compile the target JavaScript engine to be fuzzed (PUT) by afl-gcc in advance. Alternatively, there is a pre-compiled QuickJS executable available as a PUT <a href="/test/put_binaries/README.md#quickjsqjs">under <code>put_binaries</code> directory</a>.</p>
<p>You can use the same basic options as AFL but DIE mode also has some options.</p>
<ul>
<li><code>--die_dir</code>: Path to cloned DIE directory (default: <code>tools/die/DIE</code>)</li>
<li><code>--typer</code>: Path to <code>tools/die/typer.py</code> (default: <code>tools/die/typer.py</code>)</li>
<li><code>--node</code>: Command to execute JavaScript (default: <code>node</code>)</li>
<li><code>--d8</code>: Path to d8 (If not specified, PUT is used)</li>
<li><code>--d8_flags</code>: Flags passed to JS engine specified by <code>--d8</code> (default: empty)</li>
<li><code>--mut_cnt</code>: Number of scripts to be generated in one mutation (default: 100)</li>
</ul>
<h1><a class="anchor" id="autotoc_md52"></a>
Overview of Algorithm</h1>
<p>The fuzzing loop of DIE consists of "seed selection", "mutation", "execution", and "coverage feedback." DIE instruments the seed test cases and executes them to dynamically collect the type of variables in the scripts, which will be used for mutation.</p>
<h2><a class="anchor" id="autotoc_md53"></a>
Collecting Type Information</h2>
<p>DIE is a mutational fuzzer that takes one or more JavaScript files as input and changes them through mutation. DIE collects type information of the input test case dynamically and use it to reduce the amount of runtime errors. For example, consider the mutation of the following code:</p>
<div class="fragment"><div class="line">let s = &quot;Hello World&quot;;</div>
<div class="line">let v = s.split(&quot; &quot;);</div>
</div><!-- fragment --><p>If this code is mutated into the following one, a runtime error happens in the method call at the second line.</p>
<div class="fragment"><div class="line">let s = function(v) { return v; };</div>
<div class="line">let v = s.split(&quot; &quot;);</div>
</div><!-- fragment --><p>To prevent this kind of invalid mutations, DIE holds type information for each variable. First, DIE adds the following instrumentation to output type information at all points after the object definition and the object usage in the input test case.</p>
<div class="fragment"><div class="line">console.log(&quot;loc:1,typeof(s):&quot;+typeof(s));</div>
<div class="line"> </div>
<div class="line">console.log(&quot;loc:2,typeof(s):&quot;+typeof(s));</div>
<div class="line">console.log(&quot;loc:2,typeof(s.split):&quot;+typeof(s.split));</div>
<div class="line">let v = s.split(&quot; &quot;);</div>
<div class="line">console.log(&quot;loc:2,typeof(v):&quot;+typeof(v));</div>
</div><!-- fragment --><p>By executing the instrumented code, DIE dynamicaly collects type information for each variable in the script. Note that the reason why the type is checked everywhere, even for variables with the same name, is that JavaScript is a dynamically typed language.</p>
<h2><a class="anchor" id="autotoc_md54"></a>
Mutation</h2>
<p>DIE is designed to mutate only with variables of the same type as much as possible using the type information collected in advance. It also supports variables that can have multiple types in the same location depending on the execution, and object types with properties.</p>
<p>There are three main mutation strategies for DIE.</p>
<ul>
<li>Mutation with Typed AST</li>
<li>Inserting new statements</li>
<li>Creating new variables</li>
</ul>
<p>All of them are executed in a way that does not destroy the structure of the script. The number of mutations and the probability of inserting a new statement are defined in <code>DIE/fuzz/TS/esfuzz.ts</code>.</p>
<h2><a class="anchor" id="autotoc_md55"></a>
Coverage</h2>
<p>The original DIE implementation collects coverage information in the same way as AFL. The code coverage of AFL uses a hit count of one byte for each edge. However, DIE does not use a hit count, but provides one bit of data for each edge, and only records whether or not it passed through the edge. This is because in JavaScript, for example, simply changing the loop counter will increase the hit count, and such a change is meaningless. In fuzzuf, this refined coverage for JavaScript fuzzers is to be implemented in the future.</p>
<h2><a class="anchor" id="autotoc_md56"></a>
Scheduling</h2>
<p>DIE uses the same scheduling as AFL.</p>
<h2><a class="anchor" id="autotoc_md57"></a>
Distributed Fuzzing</h2>
<p>DIE can distribute the fuzzing process on multiple machines by communicating with redis server. The coverage information is also shared among all machines. However, the current fuzzuf does not implement this feature.</p>
<h1><a class="anchor" id="autotoc_md58"></a>
Reference</h1>
<p>[^die]: S. Park, W. Xu, I. Yun, D. Jang and T. Kim, "Fuzzing JavaScript Engines with Aspect-preserving Mutation," 2020 IEEE Symposium on Security and Privacy (SP), 2020, pp. 1629-1642, doi: 10.1109/SP40000.2020.00067. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
