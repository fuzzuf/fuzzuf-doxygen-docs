<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fuzzuf: executor/native_linux_executor.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fuzzuf
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_7c2730fb8449c1fd3c0779d2ebca1b41.html">executor</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">native_linux_executor.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * fuzzuf</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (C) 2021 Ricerca Security</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * This program is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * it under the terms of the GNU Affero General Public License as published by</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * (at your option) any later version.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * GNU Affero General Public License for more details.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * You should have received a copy of the GNU Affero General Public License</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * along with this program.  If not, see http://www.gnu.org/licenses/.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;fuzzuf/executor/native_linux_executor.hpp&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;cstddef&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;boost/container/static_vector.hpp&gt;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;sched.h&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;fuzzuf/algorithms/afl/afl_option.hpp&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;fuzzuf/exceptions.hpp&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;fuzzuf/executor/executor.hpp&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;fuzzuf/utils/workspace.hpp&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;fuzzuf/utils/common.hpp&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="which_8hpp.html">fuzzuf/utils/which.hpp</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="is__executable_8hpp.html">fuzzuf/utils/is_executable.hpp</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="interprocess__shared__object_8hpp.html">fuzzuf/utils/interprocess_shared_object.hpp</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;fuzzuf/utils/errno_to_system_error.hpp&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;fuzzuf/feedback/inplace_memory_feedback.hpp&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;fuzzuf/feedback/exit_status_feedback.hpp&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;fuzzuf/feedback/put_exit_reason_type.hpp&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;fuzzuf/logger/logger.hpp&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keywordtype">bool</span> NativeLinuxExecutor::has_setup_sighandlers = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<a class="code" href="classNativeLinuxExecutor.html">NativeLinuxExecutor</a>* NativeLinuxExecutor::active_instance = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="classNativeLinuxExecutor.html#a3fb711e1cc5e7e83a9e564c45d1f5ddb">   62</a></span>&#160;<a class="code" href="classNativeLinuxExecutor.html#a3fb711e1cc5e7e83a9e564c45d1f5ddb">NativeLinuxExecutor::NativeLinuxExecutor</a>(  </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;argv,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    u32 exec_timelimit_ms,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    u64 exec_memlimit,</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordtype">bool</span> forksrv,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keyword">const</span> fs::path &amp;path_to_write_input,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    u32 afl_shm_size,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    u32  bb_shm_size,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">bool</span> record_stdout_and_err,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    std::vector&lt; std::string &gt; &amp;&amp;environment_variables_,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    std::vector&lt; fs::path &gt; &amp;&amp;allowed_path_</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;) :</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="classExecutor.html">Executor</a>( argv, exec_timelimit_ms, exec_memlimit, path_to_write_input.string() ),</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    forksrv( forksrv ),</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    afl_edge_coverage(afl_shm_size),</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    fuzzuf_bb_coverage(bb_shm_size),</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// cargv and stdin_mode are initialized at SetCArgvAndDecideInputMode</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    forksrv_pid( 0 ),</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    forksrv_read_fd( -1 ),</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    forksrv_write_fd( -1 ),</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    child_timed_out( false ),</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    record_stdout_and_err( record_stdout_and_err ),</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    filesystem( std::move( allowed_path_ ) )</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;{</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">if</span> (!has_setup_sighandlers) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// For the time being, as signal handler is set globally, this function is static method, therefore it is not needed to set again if has_setup_handlers is ture.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        SetupSignalHandlers();</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        has_setup_sighandlers = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// Assign self address to static pointer to make signal handlers can refer.</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">// active_instance may refer other instance if multiple NativeLinuxExecutor exist, therefore following assertion is not appliable.</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">// assert(active_instance == nullptr);</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    active_instance = <span class="keyword">this</span>;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    SetCArgvAndDecideInputMode();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="classExecutor.html#a7e627025178196bbf161df8f35ad41bf">OpenExecutorDependantFiles</a>();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// Allocate shared memory on initialization of Executor</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// It is sufficient if each NativeLinuxExecutor::Run() can refer the memory</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    SetupSharedMemories();</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    SetupEnvironmentVariablesForTarget();</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="classNativeLinuxExecutor.html#a4eaf57240e5a9737cc83f40731a58af8">CreateJoinedEnvironmentVariables</a>( std::move( environment_variables_ ) );</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">if</span> (forksrv) {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        SetupForkServer();</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;}</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="classNativeLinuxExecutor.html#a3d5317cb9b88ceff6f28634f8027efae">  118</a></span>&#160;<a class="code" href="classNativeLinuxExecutor.html#a3d5317cb9b88ceff6f28634f8027efae">NativeLinuxExecutor::~NativeLinuxExecutor</a>() {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// Since active_instance can refer another instance of multiple N, it is considered FuzzerHandle::Reset is called if active_instance is not self value, therefore do nothing. On the other hand, assign nullptr if active_instance is self value.</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// Although, assigning nullptr just in case, since the handlers will never called when the destructor is called, it is basically not a problem.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">if</span> (active_instance == <span class="keyword">this</span>) {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        active_instance = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">if</span> (input_fd != -1) {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        Util::CloseFile(input_fd);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        input_fd = -1;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">if</span> (null_fd != -1) {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        Util::CloseFile(null_fd);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        null_fd = -1;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    EraseSharedMemories();</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span> (forksrv) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <a class="code" href="classNativeLinuxExecutor.html#aa1d5fbf00a1362b16483c846c35c9afc">TerminateForkServer</a>();</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="comment">// Although, PUT process should be handled by fork server, kill it just in case. (Since fork server is expected to be killed using kill, therefore it will never becoome a zombie. So never wait.)</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        KillChildWithoutWait();</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;}</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keywordtype">void</span> NativeLinuxExecutor::SetCArgvAndDecideInputMode() {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    assert(!argv.empty()); <span class="comment">// It&#39;s incorrect too far</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    stdin_mode = <span class="keyword">true</span>; <span class="comment">// if we find @@, then assign false to stdin_mode</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : argv ) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">if</span> ( v == <span class="stringliteral">&quot;@@&quot;</span> ) {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            stdin_mode = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            cargv.emplace_back(path_str_to_write_input.c_str());</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            cargv.emplace_back(v.c_str());</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    cargv.emplace_back(<span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="classNativeLinuxExecutor.html#aa1d5fbf00a1362b16483c846c35c9afc">  171</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNativeLinuxExecutor.html#aa1d5fbf00a1362b16483c846c35c9afc">NativeLinuxExecutor::TerminateForkServer</a>() {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">if</span> (fork_server_epoll_fd != -1) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        close( fork_server_epoll_fd );</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        fork_server_epoll_fd = -1;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">if</span> (forksrv_read_fd != -1) {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        Util::CloseFile(forksrv_read_fd);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        forksrv_read_fd = -1;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">if</span> (forksrv_write_fd != -1) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        Util::CloseFile(forksrv_write_fd);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        forksrv_write_fd = -1;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">if</span> (fork_server_stdout_fd != -1) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        close( fork_server_stdout_fd );</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        fork_server_stdout_fd = -1;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">if</span> (fork_server_stderr_fd != -1) {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        close( fork_server_stderr_fd );</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        fork_server_stderr_fd = -1;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">if</span> (forksrv_pid &gt; 0) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordtype">int</span> status;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        kill(forksrv_pid, SIGKILL);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        waitpid(forksrv_pid, &amp;status, 0);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        forksrv_pid = -1;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;}</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="classNativeLinuxExecutor.html#a4641ba48b4ecac90553adca6b69969ac">  217</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNativeLinuxExecutor.html#a4641ba48b4ecac90553adca6b69969ac">NativeLinuxExecutor::AlarmHandler</a>(<span class="keywordtype">int</span> signum) {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    assert (signum == SIGALRM);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    assert (active_instance != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    active_instance-&gt;KillChildWithoutWait();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    active_instance-&gt;child_timed_out = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment"> * An static method</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment"> * Postcondition:</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment"> *  - It defines how the fuzzuf process respond to signals.</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment"> *  - If signal handlers are needed, signal handlers are set.</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment"> * FIXME: Since the configuration on signal handlers is shared in whole process,</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment"> * it affects all fuzzuf instances running on the process.</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment"> * As the result, it requires change of process design in some cases,</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment"> * Therefore, the process design may be changed, </span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment"> * yet currently the static function is implemented under the expection that only one fuzzuf instance is used simultaneously.</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="keywordtype">void</span> NativeLinuxExecutor::SetupSignalHandlers() {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keyword">struct </span>sigaction sa;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    sa.sa_handler = NULL;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    sa.sa_flags = SA_RESTART;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    sa.sa_sigaction = NULL;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    sigemptyset(&amp;sa.sa_mask);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">// Since there is no agreement on handling following signals, ignoring for now.</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">/* Various ways of saying &quot;stop&quot;. */</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    sa.sa_handler = handle_stop_sig;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    sigaction(SIGHUP, &amp;sa, NULL);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    sigaction(SIGINT, &amp;sa, NULL);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    sigaction(SIGTERM, &amp;sa, NULL);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">/* Window resize */</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    sa.sa_handler = handle_resize;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    sigaction(SIGWINCH, &amp;sa, NULL);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">/* SIGUSR1: skip entry */</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    sa.sa_handler = handle_skipreq;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    sigaction(SIGUSR1, &amp;sa, NULL);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">/* Things we don&#39;t care about. */</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    sa.sa_handler = SIG_IGN;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    sigaction(SIGTSTP, &amp;sa, NULL);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    sigaction(SIGPIPE, &amp;sa, NULL);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    sa.sa_handler = <a class="code" href="classNativeLinuxExecutor.html#a4641ba48b4ecac90553adca6b69969ac">NativeLinuxExecutor::AlarmHandler</a>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    sigaction(SIGALRM, &amp;sa, NULL);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="keyword">namespace </span>detail {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keyword">template</span>&lt; <span class="keyword">typename</span> Dest &gt;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordtype">bool</span> read_chunk( Dest &amp;dest, <span class="keywordtype">int</span> fd ) {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        std::size_t cur_size = dest.size();</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        dest.resize(</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            cur_size + fuzzuf::executor::output_block_size</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        );</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="keyword">auto</span> read_stat = read(</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            fd,</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            std::next( dest.data(), cur_size ),</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            fuzzuf::executor::output_block_size</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        );</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">if</span>( read_stat &lt; 0 ) {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            dest.resize(cur_size); <span class="comment">// reset dest, whatever the error is</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <span class="keywordtype">int</span> e = errno;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <span class="keywordflow">if</span>( e == EAGAIN || e == EWOULDBLOCK )</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !( e == EINTR ) )</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                <span class="keywordflow">throw</span> fuzzuf::utils::errno_to_system_error(</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                    e,</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                    <span class="stringliteral">&quot;read from child process failed during the execution&quot;</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                );</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            dest.resize( cur_size + read_stat );</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">return</span> read_stat != 0;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno"><a class="line" href="classNativeLinuxExecutor.html#a9c80c00d7726e17f23bfc52d47820d67">  323</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNativeLinuxExecutor.html#a9c80c00d7726e17f23bfc52d47820d67">NativeLinuxExecutor::Run</a>(<span class="keyword">const</span> u8 *buf, u32 len, u32 timeout_ms) {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">// locked until std::shared_ptr&lt;u8&gt; lock is used in other places</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">while</span> (IsFeedbackLocked()) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        usleep(100);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">// if timeout_ms is 0, then we use exec_timelimit_ms;</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">if</span> (timeout_ms == 0) timeout_ms = exec_timelimit_ms;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// Aliases</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    ResetSharedMemories();</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">if</span> (record_stdout_and_err) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        stdout_buffer.clear();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        stderr_buffer.clear();</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    }</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <a class="code" href="classExecutor.html#a16383186c884a4b0f87620ac9308259b">WriteTestInputToFile</a>(buf, len);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">//#if 0</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="comment">// TODO: Since the information priority is Trace level that is less important than Debug, it should be hidden when runlevel is Debug.</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    DEBUG(<span class="stringliteral">&quot;Run: &quot;</span>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    DEBUG(<span class="stringliteral">&quot;%s &quot;</span>, cargv[0]);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    std::for_each( cargv.begin(), cargv.end(), []( <span class="keyword">const</span> <span class="keywordtype">char</span>* v ) { DEBUG(<span class="stringliteral">&quot;%s &quot;</span>, v); } );</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    DEBUG(<span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">//#endif</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">// This structure is shared by both parent process and child process.</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">// Since execv never returns on success, it is initialized as success(0), then set value on failed.</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keyword">auto</span> child_state = fuzzuf::utils::interprocess::create_shared_object(</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <a class="code" href="structfuzzuf_1_1executor_1_1ChildState.html">fuzzuf::executor::ChildState</a>{ 0, 0 }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    );</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    std::array&lt; int, 2u &gt; stdout_fd{ 0, 0 };</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    std::array&lt; int, 2u &gt; stderr_fd{ 0, 0 };</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    constexpr std::size_t read_size = 8u;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    boost::container::static_vector&lt; std::uint8_t, read_size &gt; read_buffer;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordtype">bool</span> timeout = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">if</span> (forksrv) {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// The value tmp which is needed only on persistent mode that is currently not implemented.</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keyword">static</span> u8 tmp[4];</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">// Request creating PUT process to fork server</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="comment">// The new PUT execution can be requested to the fork server by writing 4byte values to the pipe.</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="comment">// If the PUT launched successfully, the pid of PUT process is returned via the pipe.</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="comment">// WriteFile, ReadFile throw exception if writing or reading couldn&#39;t consume specified bytes.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <span class="comment">// FIXME: When persistent mode is implemented, this tmp must be set to the value that represent if the last execution failed for timeout.</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            Util::WriteFile(forksrv_write_fd, tmp, 4);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            read_buffer.resize( 4u );</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            Util::ReadFile( forksrv_read_fd, read_buffer.data(), 4u, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160; </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            epoll_event event;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            <span class="keyword">auto</span> left_ms = timeout_ms;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <span class="keywordflow">while</span> (left_ms &gt; 0) {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span> begin_date = std::chrono::steady_clock::now();</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                <span class="keyword">auto</span> event_count = epoll_wait( fork_server_epoll_fd, &amp;event, 1, left_ms );</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                <span class="keywordflow">if</span> ( event_count &lt; 0 ) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                    <span class="keywordtype">int</span> e = errno;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                    <span class="keywordflow">if</span>( e != EINTR )</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                        <span class="keywordflow">throw</span> fuzzuf::utils::errno_to_system_error(</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                                e,</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                                <span class="stringliteral">&quot;epoll_wait failed during the execution&quot;</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                              );</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( event_count == 0 ) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                    <span class="keywordflow">if</span> ( event.events &amp; EPOLLIN ) {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                        <span class="keywordflow">if</span> ( event.data.fd == fork_server_stdout_fd )</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                            <span class="comment">// Although the buffer may contain data larger than output_block_size, that is not a problem as it is level trigger.</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                            detail::read_chunk( stdout_buffer, fork_server_stdout_fd );</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( event.data.fd == fork_server_stderr_fd )</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                            <span class="comment">// Although the buffer may contain data larger than output_block_size, that is not a problem as it is level trigger.</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                            detail::read_chunk( stderr_buffer, fork_server_stderr_fd );</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( event.data.fd == forksrv_read_fd ) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                            std::size_t cur_size = read_buffer.size();</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                            read_buffer.resize( read_size );</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                            <span class="keyword">auto</span> read_stat = read(</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                                    forksrv_read_fd,</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                                    std::next( read_buffer.data(), cur_size ),</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                                    read_size - cur_size</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                                 );</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                            <span class="keywordflow">if</span> ( read_stat &lt; 0 ) {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                                <span class="keywordtype">int</span> e = errno;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                                <span class="keywordflow">if</span> ( !( e == EAGAIN || e == EINTR || e == EWOULDBLOCK ) )</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                                    <span class="keywordflow">throw</span> fuzzuf::utils::errno_to_system_error(</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                                            e,</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                                            <span class="stringliteral">&quot;read pid from child process failed during the execution&quot;</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                                          );</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                                read_buffer.resize( cur_size + read_stat );</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                                <span class="keywordflow">if</span> ( read_buffer.size() == read_size ) {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                                    left_ms = 0;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                                    timeout = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                                }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                            }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                        }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                    }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                    <span class="keywordflow">if</span>( event.events == EPOLLHUP || event.events == EPOLLERR )</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                        ERROR(<span class="stringliteral">&quot;pipe to the child process was unexpectedly closed&quot;</span>);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span> end_date = std::chrono::steady_clock::now();</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span> elapsed = std::chrono::duration_cast&lt; std::chrono::milliseconds &gt;( end_date - begin_date ).count();</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                <span class="keywordflow">if</span> ( left_ms &lt; elapsed ) left_ms = 0;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                <span class="keywordflow">else</span> left_ms -= elapsed;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        } <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="classFileError.html">FileError</a> &amp;e) {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            ERROR(<span class="stringliteral">&quot;Unable to request new process from fork server (OOM?)&quot;</span>);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        }</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordflow">if</span>( read_buffer.size() &gt;= 4u )</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            child_pid = *<span class="keyword">reinterpret_cast&lt;</span> std::uint32_t* <span class="keyword">&gt;</span>( read_buffer.data() );</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordflow">if</span> (child_pid &lt;= 0) ERROR(<span class="stringliteral">&quot;Fork server is misbehaving (OOM?)&quot;</span>);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">if</span> (record_stdout_and_err) {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="keywordflow">if</span> ( pipe( stdout_fd.data() ) &lt; 0 ) {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                <span class="keywordflow">throw</span> fuzzuf::utils::errno_to_system_error(</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                        errno,</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                        <span class="stringliteral">&quot;Unable to create stdout pipe&quot;</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                      );</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            <span class="keywordflow">if</span> ( pipe( stderr_fd.data() ) &lt; 0 ) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                <span class="keywordflow">throw</span> fuzzuf::utils::errno_to_system_error(</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                        errno,</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                        <span class="stringliteral">&quot;Unable to create stderr pipe&quot;</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                      );</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            }</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        child_pid = Util::Fork();</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordflow">if</span> (child_pid &lt; 0) ERROR(<span class="stringliteral">&quot;fork() failed&quot;</span>);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordflow">if</span> (!child_pid) {</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            <span class="keyword">struct </span>rlimit r;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            <span class="keywordflow">if</span> (exec_memlimit) {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                r.rlim_max = r.rlim_cur = ((rlim_t)exec_memlimit) &lt;&lt; 20;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="preprocessor">#ifdef RLIMIT_AS</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                setrlimit(RLIMIT_AS, &amp;r); <span class="comment">/* Ignore errors */</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                setrlimit(RLIMIT_DATA, &amp;r); <span class="comment">/* Ignore errors */</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ^RLIMIT_AS */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            r.rlim_max = r.rlim_cur = 0;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            setrlimit(RLIMIT_CORE, &amp;r); <span class="comment">/* Ignore errors */</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            <span class="comment">/* Isolate the process and configure standard descriptors. If out_file is</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">               specified, stdin is /dev/null; otherwise, out_fd is cloned instead. */</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            setsid();</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <span class="keywordflow">if</span> (record_stdout_and_err) {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                dup2(stdout_fd[ 1 ], 1);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                dup2(stderr_fd[ 1 ], 2);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                close( stdout_fd[ 0 ] );</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                close( stdout_fd[ 1 ] );</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                close( stderr_fd[ 0 ] );</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                close( stderr_fd[ 1 ] );</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                dup2(null_fd, 1);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                dup2(null_fd, 2);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <span class="keywordflow">if</span> (stdin_mode) {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                dup2(input_fd, 0);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="comment">// stdin is bound to /dev/null ( Providing &quot;nothing&quot; as input ).</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                dup2(null_fd, 0);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            <span class="comment">// Execute new executable binary on the child process.</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="comment">// If failed, that matter is recorded to child_state.</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            child_state-&gt;exec_result = execve(</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                cargv[0],</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                (<span class="keywordtype">char</span>**)cargv.data(),</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                <span class="keyword">const_cast&lt;</span> <span class="keywordtype">char</span>** <span class="keyword">&gt;</span>( <a class="code" href="classNativeLinuxExecutor.html#addee4cb3dc5edf75f5859aca70effb32">raw_environment_variables</a>.data() )</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        );</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            child_state-&gt;exec_errno = errno;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            <span class="comment">/* Use a distinctive bitmap value to tell the parent about execv()</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">               falling through. */</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            exit(0);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordtype">int</span> put_status; <span class="comment">// PUT&#39;s status(retrieved via waitpid)</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">if</span> (forksrv) {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">if</span>( timeout ) { <span class="comment">// The execution time may exceeded due to input that causes hanging was passed.</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            KillChildWithoutWait(); <span class="comment">// After killing PUT that timed out, retrive put_status from fork server again.</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            child_timed_out = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        }</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="keywordflow">if</span>( read_buffer.size() &lt; 8u ) {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            std::size_t cur_size = read_buffer.size();</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            read_buffer.resize( read_size );</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            Util::ReadFile(</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                    forksrv_read_fd,</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                    std::next( read_buffer.data(), cur_size ),</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                    read_size - cur_size,</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                    <span class="keyword">false</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            );</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">if</span> (record_stdout_and_err) {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <span class="keywordflow">while</span>( detail::read_chunk( stdout_buffer, fork_server_stdout_fd ) );</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            <span class="keywordflow">while</span>( detail::read_chunk( stderr_buffer, fork_server_stderr_fd ) );</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        }</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keywordflow">if</span>( read_buffer.size() &gt;= 8u )</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            put_status = *<span class="keyword">reinterpret_cast&lt;</span> std::uint32_t* <span class="keyword">&gt;</span>( std::next( read_buffer.data(), 4u ) );</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            ERROR(<span class="stringliteral">&quot;Unable to communicate with fork server (OOM?)&quot;</span>);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="comment">// Initialize a flag that indicate whether the PUT hanged.</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="comment">// It is set in the signal handler.</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        child_timed_out = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="keyword">static</span> <span class="keyword">struct </span>itimerval it;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="comment">// Set timer to make SIGALRM to be sent on timeout.</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">// The handler for SIGALRM is set to NativeLinuxExecutor::AlarmHandler, and the PUT is killed in inside.</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="comment">// Yet SIGALRM is not set if exec_timelimit_ms is set to 0.</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordflow">if</span> (exec_timelimit_ms) {        </div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            it.it_value.tv_sec = (timeout_ms / 1000);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            it.it_value.tv_usec = (timeout_ms % 1000) * 1000;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            setitimer(ITIMER_REAL, &amp;it, NULL);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="comment">// If record_stdout_and_err is true, here starts the loop for saving outputs to buffers.</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">if</span> (record_stdout_and_err) {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            close( stdout_fd[ 1 ] );</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            close( stderr_fd[ 1 ] );</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            <span class="keyword">auto</span> epoll_fd = epoll_create( 1 );</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            epoll_event stdout_event;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            stdout_event.data.fd = stdout_fd[ 0 ];</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            stdout_event.events = EPOLLIN|EPOLLRDHUP;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            <span class="keywordflow">if</span>( epoll_ctl(</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                        epoll_fd,</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                        EPOLL_CTL_ADD,</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                        stdout_fd[ 0 ],</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                        &amp;stdout_event</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                ) &lt; 0 ) {</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                <span class="keywordflow">throw</span> fuzzuf::utils::errno_to_system_error(</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                        errno,</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                        <span class="stringliteral">&quot;Unable to epoll stdout pipe&quot;</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                        );</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            epoll_event stderr_event;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            stderr_event.data.fd = stderr_fd[ 0 ];</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            stderr_event.events = EPOLLIN|EPOLLRDHUP;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <span class="keywordflow">if</span>( epoll_ctl(</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                        epoll_fd,</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                        EPOLL_CTL_ADD,</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                        stderr_fd[ 0 ],</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                        &amp;stderr_event</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                ) &lt; 0 ) {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                <span class="keywordflow">throw</span> fuzzuf::utils::errno_to_system_error(</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                        errno,</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                        <span class="stringliteral">&quot;Unable to epoll stdout pipe&quot;</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                        );</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            epoll_event event;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <span class="keyword">auto</span> left_ms = timeout_ms;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> closed_count = 0u;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            fcntl( stdout_fd[ 0 ], F_SETFL, O_NONBLOCK );</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            fcntl( stderr_fd[ 0 ], F_SETFL, O_NONBLOCK );</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            <span class="keywordflow">while</span> (left_ms &gt; 0) {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span> begin_date = std::chrono::steady_clock::now();</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                <span class="keyword">auto</span> event_count = epoll_wait( epoll_fd, &amp;event, 1, left_ms );</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                <span class="keywordflow">if</span>( event_count &lt; 0 ) {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                    <span class="keywordtype">int</span> e = errno;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                    <span class="keywordflow">if</span>( e != EINTR ) {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                        <span class="keywordflow">throw</span> fuzzuf::utils::errno_to_system_error(</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                                e,</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                <span class="stringliteral">&quot;epoll_wait failed during the execution&quot;</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                                );</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                    }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( event_count == 0 ) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                    <span class="keywordflow">if</span>( event.events &amp; EPOLLIN ) {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                        <span class="keywordflow">if</span>( event.data.fd == stdout_fd[ 0 ] )</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                            <span class="comment">// Although the buffer may contain data larger than output_block_size, that is not a problem as it is level trigger.</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                            detail::read_chunk( stdout_buffer, stdout_fd[ 0 ] );</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( event.data.fd == stderr_fd[ 0 ] )</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                            <span class="comment">// Although the buffer may contain data larger than output_block_size, that is not a problem as it is level trigger.</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                            detail::read_chunk( stderr_buffer, stderr_fd[ 0 ] );</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                    }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                    <span class="keywordflow">if</span>( event.events == EPOLLHUP || event.events == EPOLLERR ) {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                        ++closed_count;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                        <span class="keywordflow">if</span>( closed_count == 2u )</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                    }</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span> end_date = std::chrono::steady_clock::now();</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span> elapsed = std::chrono::duration_cast&lt; std::chrono::milliseconds &gt;( end_date - begin_date ).count();</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                <span class="keywordflow">if</span>( left_ms &lt; elapsed ) left_ms = 0;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                <span class="keywordflow">else</span> left_ms -= elapsed;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            close( epoll_fd );</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">if</span> (waitpid(child_pid, &amp;put_status, 0) &lt;= 0) ERROR(<span class="stringliteral">&quot;waitpid() failed&quot;</span>);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keywordflow">if</span> (record_stdout_and_err) {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordtype">bool</span> cont = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <span class="keywordflow">while</span>( cont ) {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                cont = detail::read_chunk( stdout_buffer, stdout_fd[ 0 ] );</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            cont = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <span class="keywordflow">while</span>( cont ) {</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                cont = detail::read_chunk( stderr_buffer, stderr_fd[ 0 ] );</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            close( stdout_fd[ 0 ] );</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            close( stderr_fd[ 0 ] );</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        }</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160; </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="comment">// Reset the timer.</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">if</span> (exec_timelimit_ms) {</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            it.it_value.tv_sec = 0;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            it.it_value.tv_usec = 0;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            setitimer(ITIMER_REAL, &amp;it, NULL);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    }</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160; </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="comment">// If the PUT process is not stopped but exited ( It should happen except in persistent mode ), since child_pid is no longer needed, it can be set to 0.</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">if</span> (!WIFSTOPPED(put_status)) child_pid = 0; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    DEBUG(<span class="stringliteral">&quot;Exec Status %d (pid %d)\n&quot;</span>, put_status, child_pid);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160; </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="comment">/* Any subsequent operations on trace_bits must not be moved by the</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">       compiler below this point. Past this location, trace_bits[] behave</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">       very normally and do not have to be treated as volatile. */</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160; </div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    MEM_BARRIER();</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="comment">// Following implementation is dirty.</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="comment">// This may be inherited implementation from afl, and it may feel dirty, so it shall be fixed.</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    u32 tb4 = 0;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="comment">// Consider execution was failed if execv of child process failed.</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">if</span> ( child_state-&gt;exec_result &lt; 0 )</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        tb4 = EXEC_FAIL_SIG;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    last_exit_reason = PUTExitReasonType::FAULT_NONE;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    last_signal = 0;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="comment">/* Report outcome to caller. */</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">if</span> (WIFSIGNALED(put_status)) {</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        last_signal = WTERMSIG(put_status);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">if</span> (child_timed_out &amp;&amp; last_signal == SIGKILL) </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            last_exit_reason = PUTExitReasonType::FAULT_TMOUT;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keywordflow">else</span> </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            last_exit_reason = PUTExitReasonType::FAULT_CRASH;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="comment">/* A somewhat nasty hack for MSAN, which doesn&#39;t support abort_on_error and</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">       must use a special exit code. */</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keywordflow">if</span> (uses_asan &amp;&amp; WEXITSTATUS(put_status) == MSAN_ERROR) {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        last_exit_reason = PUTExitReasonType::FAULT_CRASH;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    }</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">if</span> ( !forksrv &amp;&amp; tb4 == EXEC_FAIL_SIG) {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        last_exit_reason = PUTExitReasonType::FAULT_ERROR;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    last_exit_reason = PUTExitReasonType::FAULT_NONE;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;}</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;u32 NativeLinuxExecutor::GetAFLMapSize() {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keywordflow">return</span> afl_edge_coverage.GetMapSize();</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;}</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;u32 NativeLinuxExecutor::GetBBMapSize() {</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">return</span> fuzzuf_bb_coverage.GetMapSize();</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;}</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160; </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="keywordtype">int</span> NativeLinuxExecutor::GetAFLShmID() {</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">return</span> afl_edge_coverage.GetShmID();</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;}</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="keywordtype">int</span> NativeLinuxExecutor::GetBBShmID() {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">return</span> fuzzuf_bb_coverage.GetShmID();</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;}</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160; </div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<a class="code" href="classInplaceMemoryFeedback.html">InplaceMemoryFeedback</a> NativeLinuxExecutor::GetAFLFeedback() {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">return</span> afl_edge_coverage.GetFeedback();</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;}</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<a class="code" href="classInplaceMemoryFeedback.html">InplaceMemoryFeedback</a> NativeLinuxExecutor::GetBBFeedback() {</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordflow">return</span> fuzzuf_bb_coverage.GetFeedback();</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;}</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<a class="code" href="classInplaceMemoryFeedback.html">InplaceMemoryFeedback</a> NativeLinuxExecutor::GetStdOut() {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classInplaceMemoryFeedback.html">InplaceMemoryFeedback</a>( stdout_buffer.data(), stdout_buffer.size(), lock);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;}</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<a class="code" href="classInplaceMemoryFeedback.html">InplaceMemoryFeedback</a> NativeLinuxExecutor::GetStdErr() {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classInplaceMemoryFeedback.html">InplaceMemoryFeedback</a>( stderr_buffer.data(), stderr_buffer.size(), lock);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;}</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<a class="code" href="classExitStatusFeedback.html">ExitStatusFeedback</a> NativeLinuxExecutor::GetExitStatusFeedback() {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classExitStatusFeedback.html">ExitStatusFeedback</a>(last_exit_reason, last_signal);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;}</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="keywordtype">bool</span> NativeLinuxExecutor::IsFeedbackLocked() {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keywordflow">return</span> (lock.use_count() &gt; 1)</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    || (afl_edge_coverage.GetLockUseCount() &gt; 1)</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    || (fuzzuf_bb_coverage.GetLockUseCount() &gt; 1);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;}</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">// Initialize shared memory group that the PUT writes the coverage.</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment">// These shared memory is reused for all PUTs (It is too slow to allocate for each PUT).</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="keywordtype">void</span> NativeLinuxExecutor::SetupSharedMemories() {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    afl_edge_coverage.Setup();</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    fuzzuf_bb_coverage.Setup();</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;}</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; </div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="comment">// Since shared memory is reused, it is initialized every time before passed to PUT.</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="keywordtype">void</span> NativeLinuxExecutor::ResetSharedMemories() {</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    afl_edge_coverage.Reset();</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    fuzzuf_bb_coverage.Reset();</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;}</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment">// Delete SharedMemory when the Executor is deleted</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="keywordtype">void</span> NativeLinuxExecutor::EraseSharedMemories() {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    afl_edge_coverage.Erase();</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    fuzzuf_bb_coverage.Erase();</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;}</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160; </div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">// Since PUT that is instrumented using afl-clang-fast or fuzzuf-cc</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment">// interprets some environment variables, this is the configuration for it.</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment">// Although, this is actually what the child process running PUT should do,</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment">// since there are no environment variables need update for each PUT execution for now,</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">// by using feature that environment variables are inherited to child process, it is enough to do just once ( let&#39;s move it if not ).</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment">// As the additional advantage, it can avoid to waste Copy on Write of heap region due to StrPrintf.</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="keywordtype">void</span> NativeLinuxExecutor::SetupEnvironmentVariablesForTarget() {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="comment">// Pass the id of shared memory to PUT.</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    afl_edge_coverage.SetupEnvironmentVariable();</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    fuzzuf_bb_coverage.SetupEnvironmentVariable();</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; </div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="comment">/* This should improve performance a bit, since it stops the linker from</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment">        doing extra work post-fork(). */</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">if</span> (!getenv(<span class="stringliteral">&quot;LD_BIND_LAZY&quot;</span>)) setenv(<span class="stringliteral">&quot;LD_BIND_NOW&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, 1); </div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="comment">// Since MSAN, ASAN and UBSAN related configurations below are inherited from AFL and not used in fuzzuf, it is not required. But since those functionality is  considered implementable without conflicts in fuzzuf in future, these configuration are left.</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    setenv(<span class="stringliteral">&quot;ASAN_OPTIONS&quot;</span>,</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="stringliteral">&quot;abort_on_error=1:&quot;</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        <span class="stringliteral">&quot;detect_leaks=0:&quot;</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="stringliteral">&quot;malloc_context_size=0:&quot;</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <span class="stringliteral">&quot;symbolize=0:&quot;</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="stringliteral">&quot;allocator_may_return_null=1:&quot;</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="stringliteral">&quot;detect_odr_violation=0:&quot;</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="stringliteral">&quot;handle_segv=0:&quot;</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="stringliteral">&quot;handle_sigbus=0:&quot;</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="stringliteral">&quot;handle_abort=0:&quot;</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="stringliteral">&quot;handle_sigfpe=0:&quot;</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="stringliteral">&quot;handle_sigill=0&quot;</span>,</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        0);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160; </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    setenv(<span class="stringliteral">&quot;MSAN_OPTIONS&quot;</span>,</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        Util::StrPrintf(</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;           <span class="stringliteral">&quot;exit_code=%d:&quot;</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;           <span class="stringliteral">&quot;symbolize=0:&quot;</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;           <span class="stringliteral">&quot;abort_on_error=1:&quot;</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;           <span class="stringliteral">&quot;malloc_context_size=0:&quot;</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;           <span class="stringliteral">&quot;allocator_may_return_null=1:&quot;</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;           <span class="stringliteral">&quot;msan_track_origins=0:&quot;</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;           <span class="stringliteral">&quot;handle_segv=0:&quot;</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;           <span class="stringliteral">&quot;handle_sigbus=0:&quot;</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;           <span class="stringliteral">&quot;handle_abort=0:&quot;</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;           <span class="stringliteral">&quot;handle_sigfpe=0:&quot;</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;           <span class="stringliteral">&quot;handle_sigill=0&quot;</span>,</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;           MSAN_ERROR</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        ).c_str(),</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        0);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160; </div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    setenv(<span class="stringliteral">&quot;UBSAN_OPTIONS&quot;</span>,</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="stringliteral">&quot;halt_on_error=1:&quot;</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <span class="stringliteral">&quot;abort_on_error=1:&quot;</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="stringliteral">&quot;malloc_context_size=0:&quot;</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="stringliteral">&quot;allocator_may_return_null=1:&quot;</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="stringliteral">&quot;symbolize=0:&quot;</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="stringliteral">&quot;handle_segv=0:&quot;</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="stringliteral">&quot;handle_sigbus=0:&quot;</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <span class="stringliteral">&quot;handle_abort=0:&quot;</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="stringliteral">&quot;handle_sigfpe=0:&quot;</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        <span class="stringliteral">&quot;handle_sigill=0&quot;</span>,</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        0);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;}</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160; </div>
<div class="line"><a name="l00827"></a><span class="lineno"><a class="line" href="classNativeLinuxExecutor.html#a4eaf57240e5a9737cc83f40731a58af8">  827</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNativeLinuxExecutor.html#a4eaf57240e5a9737cc83f40731a58af8">NativeLinuxExecutor::CreateJoinedEnvironmentVariables</a>(</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    std::vector&lt; std::string &gt; &amp;&amp;extra</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;) {</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <a class="code" href="classNativeLinuxExecutor.html#a6e06c5246db02f0fe87227828ce826ab">environment_variables</a>.clear();</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <a class="code" href="classNativeLinuxExecutor.html#addee4cb3dc5edf75f5859aca70effb32">raw_environment_variables</a>.clear();</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">auto</span> e = environ; *e; ++e )</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <a class="code" href="classNativeLinuxExecutor.html#a6e06c5246db02f0fe87227828ce826ab">environment_variables</a>.push_back( *e );</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    std::move(</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      extra.begin(),</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      extra.end(),</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      std::back_inserter( <a class="code" href="classNativeLinuxExecutor.html#a6e06c5246db02f0fe87227828ce826ab">environment_variables</a> )</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    );</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <a class="code" href="classNativeLinuxExecutor.html#a6e06c5246db02f0fe87227828ce826ab">environment_variables</a>.shrink_to_fit();</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <a class="code" href="classNativeLinuxExecutor.html#addee4cb3dc5edf75f5859aca70effb32">raw_environment_variables</a>.reserve( <a class="code" href="classNativeLinuxExecutor.html#a6e06c5246db02f0fe87227828ce826ab">environment_variables</a>.size() );</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    std::transform(</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <a class="code" href="classNativeLinuxExecutor.html#a6e06c5246db02f0fe87227828ce826ab">environment_variables</a>.begin(),</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <a class="code" href="classNativeLinuxExecutor.html#a6e06c5246db02f0fe87227828ce826ab">environment_variables</a>.end(),</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      std::back_inserter( <a class="code" href="classNativeLinuxExecutor.html#addee4cb3dc5edf75f5859aca70effb32">raw_environment_variables</a> ),</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      []( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;e ) { return e.c_str(); }</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    );</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <a class="code" href="classNativeLinuxExecutor.html#addee4cb3dc5edf75f5859aca70effb32">raw_environment_variables</a>.push_back( <span class="keyword">nullptr</span> );</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <a class="code" href="classNativeLinuxExecutor.html#addee4cb3dc5edf75f5859aca70effb32">raw_environment_variables</a>.shrink_to_fit();</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;}</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160; </div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment"> * Precondition:</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment"> *  - The target PUT is a binary that supports fork server mode.</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment"> * Postcondition:</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment"> *  - Generate child process, then launch PUT in fork server mode on the child process side.</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment"> *  - Apply proper limits ( ex. memory limits ) on PUT.</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment"> *  - Setup the pipe between parent process ( the process that runs fuzzuf ) and child process.</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="keywordtype">void</span> NativeLinuxExecutor::SetupForkServer() {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="comment">// set of fd of pipe.</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="comment">// Each is used for parent -&gt; child and child -&gt; parent data transfer.</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordtype">int</span> par2chld[2], chld2par[2];</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160; </div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">if</span> (pipe(par2chld) || pipe(chld2par)) ERROR(<span class="stringliteral">&quot;pipe() failed&quot;</span>);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    std::array&lt; int, 2u &gt; stdout_fd{ -1, -1 };</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    std::array&lt; int, 2u &gt; stderr_fd{ -1, -1 };</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordflow">if</span> (record_stdout_and_err) {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="keywordflow">if</span> ( pipe( stdout_fd.data() ) &lt; 0 ) {</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            ERROR(<span class="stringliteral">&quot;Unable to create stdout pipe&quot;</span>);</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        }</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <span class="keywordflow">if</span> ( pipe( stderr_fd.data() ) &lt; 0 ) {</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            ERROR(<span class="stringliteral">&quot;Unable to create stderr pipe&quot;</span>);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        }</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    }</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160; </div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    forksrv_pid = fork();</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordflow">if</span> (forksrv_pid &lt; 0) ERROR(<span class="stringliteral">&quot;fork() failed&quot;</span>);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160; </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">if</span> (!forksrv_pid) {</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="keyword">struct </span>rlimit r;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        <span class="comment">/* Umpf. On OpenBSD, the default fd limit for root users is set to</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">           soft 128. Let&#39;s try to fix that... */</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160; </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="comment">// Although since FORKSRV_FD_WRITE=199, FORKSRV_FD_READ=198, the required limit is 200,</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="comment">// set std::max() + 1 to suppose those values are changed in future.</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> needed_fd_lim = std::max(FORKSRV_FD_WRITE, FORKSRV_FD_READ) + 1;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="keywordflow">if</span> (!getrlimit(RLIMIT_NOFILE, &amp;r) &amp;&amp; r.rlim_cur &lt; needed_fd_lim) {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160; </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            r.rlim_cur = needed_fd_lim;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            setrlimit(RLIMIT_NOFILE, &amp;r); <span class="comment">/* Ignore errors */</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <span class="keywordflow">if</span> (exec_memlimit) {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            r.rlim_max = r.rlim_cur = ((rlim_t)exec_memlimit) &lt;&lt; 20;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; </div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="preprocessor">#ifdef RLIMIT_AS</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            setrlimit(RLIMIT_AS, &amp;r); <span class="comment">/* Ignore errors */</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;          <span class="comment">/* This takes care of OpenBSD, which doesn&#39;t have RLIMIT_AS, but</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment">             according to reliable sources, RLIMIT_DATA covers anonymous</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">             maps - so we should be getting good protection against OOM bugs. */</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            setrlimit(RLIMIT_DATA, &amp;r); <span class="comment">/* Ignore errors */</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ^RLIMIT_AS */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160; </div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160; </div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        }</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160; </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        r.rlim_max = r.rlim_cur = 0;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        setrlimit(RLIMIT_CORE, &amp;r);</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        setsid();</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160; </div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <span class="keywordflow">if</span> (record_stdout_and_err) {</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            dup2(stdout_fd[ 1 ], 1);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            dup2(stderr_fd[ 1 ], 2);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            close( stdout_fd[ 0 ] );</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            close( stderr_fd[ 0 ] );</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            dup2(null_fd, 1);</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            dup2(null_fd, 2);</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        }</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="keywordflow">if</span> (stdin_mode) {</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            dup2(input_fd, 0);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            dup2(null_fd, 0);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        }</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160; </div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        <span class="keywordflow">if</span> (dup2(par2chld[0], FORKSRV_FD_READ) &lt; 0) ERROR(<span class="stringliteral">&quot;dup2() failed&quot;</span>);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="keywordflow">if</span> (dup2(chld2par[1], FORKSRV_FD_WRITE) &lt; 0) ERROR(<span class="stringliteral">&quot;dup2() failed&quot;</span>);</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160; </div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        close(par2chld[0]);</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        close(par2chld[1]);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        close(chld2par[0]);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        close(chld2par[1]);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        execve(</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            cargv[0],</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            (<span class="keywordtype">char</span>**)cargv.data(),</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            <span class="keyword">const_cast&lt;</span> <span class="keywordtype">char</span>** <span class="keyword">&gt;</span>( <a class="code" href="classNativeLinuxExecutor.html#addee4cb3dc5edf75f5859aca70effb32">raw_environment_variables</a>.data() )</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    );</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="comment">// TODO: It must be discussed whether it is needed that equivalent to EXEC_FAIL_SIG that is used in non-fork server mode.</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        exit(0);</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    close(par2chld[0]);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    close(chld2par[1]);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="keywordflow">if</span> (record_stdout_and_err) {</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        close( stdout_fd[ 1 ] );</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        close( stderr_fd[ 1 ] );</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        fork_server_stdout_fd = stdout_fd[ 0 ];</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        fork_server_stderr_fd = stderr_fd[ 0 ];</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        fcntl( fork_server_stdout_fd, F_SETFL, O_NONBLOCK );</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        fcntl( fork_server_stderr_fd, F_SETFL, O_NONBLOCK );</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    }</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    fork_server_epoll_fd = epoll_create( 1 );</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordflow">if</span> (record_stdout_and_err) {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        fork_server_stdout_event.data.fd = fork_server_stdout_fd;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        fork_server_stdout_event.events = EPOLLIN|EPOLLRDHUP;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <span class="keywordflow">if</span> (epoll_ctl(</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;              fork_server_epoll_fd,</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;              EPOLL_CTL_ADD,</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;              fork_server_stdout_fd,</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;              &amp;fork_server_stdout_event</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            ) &lt; 0 ) {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160; </div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;            ERROR(<span class="stringliteral">&quot;Unable to epoll stdout pipe&quot;</span>);</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        }</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160; </div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        fork_server_stderr_event.data.fd = fork_server_stderr_fd;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        fork_server_stderr_event.events = EPOLLIN|EPOLLRDHUP;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <span class="keywordflow">if</span> (epoll_ctl(</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                fork_server_epoll_fd,</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                EPOLL_CTL_ADD,</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                fork_server_stderr_fd,</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                &amp;fork_server_stderr_event</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            ) &lt; 0 ) {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160; </div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            ERROR(<span class="stringliteral">&quot;Unable to epoll stderr pipe&quot;</span>);</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        }</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    }</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160; </div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    forksrv_write_fd = par2chld[1];</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    forksrv_read_fd = chld2par[0];</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    fork_server_read_event.data.fd = forksrv_read_fd;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    fork_server_read_event.events = EPOLLIN|EPOLLRDHUP;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="keywordflow">if</span>( epoll_ctl(</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      fork_server_epoll_fd,</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      EPOLL_CTL_ADD,</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      forksrv_read_fd,</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      &amp;fork_server_read_event</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    ) &lt; 0 ) {</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      ERROR(<span class="stringliteral">&quot;Unable to epoll read pipe&quot;</span>);</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    }</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="comment">// Wait for fork server to launch with 10 seconds of time limit (Conforming AFL++ that looks waiting 10 seconds.).</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="comment">// The handshake is sent from remote on launched.</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    u8 tmp[4];</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    u32 time_limit = 10000;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    u32 res = Util::ReadFileTimed(forksrv_read_fd, &amp;tmp, 4, time_limit);</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="comment">// FIXME: There are various reason to fail fork server, and as the responses varies and identifiable, it is more decent to classify them.</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordflow">if</span> (res == 0 || res &gt; time_limit) { </div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <a class="code" href="classNativeLinuxExecutor.html#aa1d5fbf00a1362b16483c846c35c9afc">TerminateForkServer</a>();</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        ERROR(<span class="stringliteral">&quot;Fork server crashed&quot;</span>);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    }</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160; </div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;}</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160; </div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment">// this function may be called in signal handlers.</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">// use only async-signal-safe functions inside.</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">// basically, we care about only the case where NativeLinuxExecutor::Run is running.</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment">// in that case, we should kill the child process(of PUT) so that NativeLinuxExecutor could halt without waiting the timeout.</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">// if this function is called during the call of other functions, then the child process is not active.</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">// we can call KillChildWithoutWait() anyways because the function checks if the child process is active.</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="keywordtype">void</span> NativeLinuxExecutor::ReceiveStopSignal(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="comment">// kill is async-signal-safe</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="comment">// the child process is active only in NativeLinuxExecutor::Run and Run always uses waitpid, so we don&#39;t need to use waitpid here</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    KillChildWithoutWait();</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;}</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160; </div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;fuzzuf::executor::output_t NativeLinuxExecutor::MoveStdOut() {</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="keywordflow">return</span> std::move( stdout_buffer );</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;}</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; </div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;fuzzuf::executor::output_t NativeLinuxExecutor::MoveStdErr() {</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="keywordflow">return</span> std::move( stderr_buffer );</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclassNativeLinuxExecutor_html_a4641ba48b4ecac90553adca6b69969ac"><div class="ttname"><a href="classNativeLinuxExecutor.html#a4641ba48b4ecac90553adca6b69969ac">NativeLinuxExecutor::AlarmHandler</a></div><div class="ttdeci">static void AlarmHandler(int signum)</div><div class="ttdef"><b>Definition:</b> <a href="native__linux__executor_8cpp_source.html#l00217">native_linux_executor.cpp:217</a></div></div>
<div class="ttc" id="aclassExitStatusFeedback_html"><div class="ttname"><a href="classExitStatusFeedback.html">ExitStatusFeedback</a></div><div class="ttdef"><b>Definition:</b> <a href="exit__status__feedback_8hpp_source.html#l00025">exit_status_feedback.hpp:25</a></div></div>
<div class="ttc" id="aclassNativeLinuxExecutor_html_a3fb711e1cc5e7e83a9e564c45d1f5ddb"><div class="ttname"><a href="classNativeLinuxExecutor.html#a3fb711e1cc5e7e83a9e564c45d1f5ddb">NativeLinuxExecutor::NativeLinuxExecutor</a></div><div class="ttdeci">NativeLinuxExecutor(const std::vector&lt; std::string &gt; &amp;argv, u32 exec_timelimit_ms, u64 exec_memlimit, bool forksrv, const fs::path &amp;path_to_write_input, u32 afl_shm_size, u32 bb_shm_size, bool record_stdout_and_err=false, std::vector&lt; std::string &gt; &amp;&amp;environment_variables_={}, std::vector&lt; fs::path &gt; &amp;&amp;allowed_path_={})</div><div class="ttdef"><b>Definition:</b> <a href="native__linux__executor_8cpp_source.html#l00062">native_linux_executor.cpp:62</a></div></div>
<div class="ttc" id="aclassNativeLinuxExecutor_html_a6e06c5246db02f0fe87227828ce826ab"><div class="ttname"><a href="classNativeLinuxExecutor.html#a6e06c5246db02f0fe87227828ce826ab">NativeLinuxExecutor::environment_variables</a></div><div class="ttdeci">std::vector&lt; std::string &gt; environment_variables</div><div class="ttdef"><b>Definition:</b> <a href="native__linux__executor_8hpp_source.html#l00166">native_linux_executor.hpp:166</a></div></div>
<div class="ttc" id="aclassNativeLinuxExecutor_html"><div class="ttname"><a href="classNativeLinuxExecutor.html">NativeLinuxExecutor</a></div><div class="ttdef"><b>Definition:</b> <a href="native__linux__executor_8hpp_source.html#l00044">native_linux_executor.hpp:44</a></div></div>
<div class="ttc" id="aclassNativeLinuxExecutor_html_a3d5317cb9b88ceff6f28634f8027efae"><div class="ttname"><a href="classNativeLinuxExecutor.html#a3d5317cb9b88ceff6f28634f8027efae">NativeLinuxExecutor::~NativeLinuxExecutor</a></div><div class="ttdeci">~NativeLinuxExecutor()</div><div class="ttdef"><b>Definition:</b> <a href="native__linux__executor_8cpp_source.html#l00118">native_linux_executor.cpp:118</a></div></div>
<div class="ttc" id="astructfuzzuf_1_1executor_1_1ChildState_html"><div class="ttname"><a href="structfuzzuf_1_1executor_1_1ChildState.html">fuzzuf::executor::ChildState</a></div><div class="ttdef"><b>Definition:</b> <a href="executor_8hpp_source.html#l00026">executor.hpp:26</a></div></div>
<div class="ttc" id="aclassFileError_html"><div class="ttname"><a href="classFileError.html">FileError</a></div><div class="ttdef"><b>Definition:</b> <a href="common_8hpp_source.html#l00120">common.hpp:120</a></div></div>
<div class="ttc" id="aclassNativeLinuxExecutor_html_addee4cb3dc5edf75f5859aca70effb32"><div class="ttname"><a href="classNativeLinuxExecutor.html#addee4cb3dc5edf75f5859aca70effb32">NativeLinuxExecutor::raw_environment_variables</a></div><div class="ttdeci">std::vector&lt; const char * &gt; raw_environment_variables</div><div class="ttdef"><b>Definition:</b> <a href="native__linux__executor_8hpp_source.html#l00173">native_linux_executor.hpp:173</a></div></div>
<div class="ttc" id="aclassNativeLinuxExecutor_html_a9c80c00d7726e17f23bfc52d47820d67"><div class="ttname"><a href="classNativeLinuxExecutor.html#a9c80c00d7726e17f23bfc52d47820d67">NativeLinuxExecutor::Run</a></div><div class="ttdeci">void Run(const u8 *buf, u32 len, u32 timeout_ms=0)</div><div class="ttdef"><b>Definition:</b> <a href="native__linux__executor_8cpp_source.html#l00323">native_linux_executor.cpp:323</a></div></div>
<div class="ttc" id="aclassExecutor_html_a16383186c884a4b0f87620ac9308259b"><div class="ttname"><a href="classExecutor.html#a16383186c884a4b0f87620ac9308259b">Executor::WriteTestInputToFile</a></div><div class="ttdeci">void WriteTestInputToFile(const u8 *buf, u32 len)</div><div class="ttdef"><b>Definition:</b> <a href="executor_8cpp_source.html#l00082">executor.cpp:82</a></div></div>
<div class="ttc" id="aclassExecutor_html_a7e627025178196bbf161df8f35ad41bf"><div class="ttname"><a href="classExecutor.html#a7e627025178196bbf161df8f35ad41bf">Executor::OpenExecutorDependantFiles</a></div><div class="ttdeci">void OpenExecutorDependantFiles()</div><div class="ttdef"><b>Definition:</b> <a href="executor_8cpp_source.html#l00060">executor.cpp:60</a></div></div>
<div class="ttc" id="ainterprocess__shared__object_8hpp_html"><div class="ttname"><a href="interprocess__shared__object_8hpp.html">interprocess_shared_object.hpp</a></div></div>
<div class="ttc" id="aclassInplaceMemoryFeedback_html"><div class="ttname"><a href="classInplaceMemoryFeedback.html">InplaceMemoryFeedback</a></div><div class="ttdef"><b>Definition:</b> <a href="inplace__memory__feedback_8hpp_source.html#l00028">inplace_memory_feedback.hpp:28</a></div></div>
<div class="ttc" id="aclassExecutor_html"><div class="ttname"><a href="classExecutor.html">Executor</a></div><div class="ttdef"><b>Definition:</b> <a href="executor_8hpp_source.html#l00043">executor.hpp:43</a></div></div>
<div class="ttc" id="aclassNativeLinuxExecutor_html_a4eaf57240e5a9737cc83f40731a58af8"><div class="ttname"><a href="classNativeLinuxExecutor.html#a4eaf57240e5a9737cc83f40731a58af8">NativeLinuxExecutor::CreateJoinedEnvironmentVariables</a></div><div class="ttdeci">void CreateJoinedEnvironmentVariables(std::vector&lt; std::string &gt; &amp;&amp;extra)</div><div class="ttdef"><b>Definition:</b> <a href="native__linux__executor_8cpp_source.html#l00827">native_linux_executor.cpp:827</a></div></div>
<div class="ttc" id="aclassNativeLinuxExecutor_html_aa1d5fbf00a1362b16483c846c35c9afc"><div class="ttname"><a href="classNativeLinuxExecutor.html#aa1d5fbf00a1362b16483c846c35c9afc">NativeLinuxExecutor::TerminateForkServer</a></div><div class="ttdeci">void TerminateForkServer()</div><div class="ttdef"><b>Definition:</b> <a href="native__linux__executor_8cpp_source.html#l00171">native_linux_executor.cpp:171</a></div></div>
<div class="ttc" id="ais__executable_8hpp_html"><div class="ttname"><a href="is__executable_8hpp.html">is_executable.hpp</a></div></div>
<div class="ttc" id="awhich_8hpp_html"><div class="ttname"><a href="which_8hpp.html">which.hpp</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
