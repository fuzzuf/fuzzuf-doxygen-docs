<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fuzzuf: Random.js</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fuzzuf
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Random.js </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/ckknight/random-js"><object type="image/svg+xml" data="https://travis-ci.org/ckknight/random-js.svg?branch=master" style="pointer-events: none;">Build Status</object></a></p>
<p>This is designed to be a mathematically correct random number generator library for JavaScript.</p>
<p>Inspiration was primarily taken from C++11's <code>&lt;random&gt;</code>.</p>
<h1><a class="anchor" id="autotoc_md2107"></a>
Upgrading from 1.0</h1>
<p>Upgrading from 1.0 to 2.0 is a major, breaking change. For the most part, the way exports are defined is different. Instead of everything being available as static properties on a class-like function, random-js 2.0 exports each binding in accordance with current ECMAScript standards.</p>
<h1><a class="anchor" id="autotoc_md2108"></a>
Why is this needed?</h1>
<p>Despite <code>Math.random()</code> being capable of producing numbers within [0, 1), there are a few downsides to doing so:</p>
<ul>
<li>It is inconsistent between engines as to how many bits of randomness:<ul>
<li>Internet Explorer: 53 bits</li>
<li>Mozilla Firefox: 53 bits</li>
<li>Google Chrome/node.js: 32 bits</li>
<li>Apple Safari: 32 bits</li>
</ul>
</li>
<li>It is non-deterministic, which means you can't replay results consistently</li>
<li>In older browsers, there can be manipulation through cross-frame random polling. <em>This is mostly fixed in newer browsers and is required to be fixed in ECMAScript 6.</em></li>
</ul>
<p>Also, and most crucially, most developers tend to use improper and biased logic as to generating integers within a uniform distribution.</p>
<h1><a class="anchor" id="autotoc_md2109"></a>
How does Random.js alleviate these problems?</h1>
<p>Random.js provides a set of "engines" for producing random integers, which consistently provide values within [0, 4294967295], i.e. 32 bits of randomness.</p>
<ul>
<li><code>nativeMath</code>: Utilizes <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random"><code>Math.random()</code></a> and converts its result to a signed integer. This is appropriate to use if you do not care for a deterministic implementation. Based on the implementation (which is hidden to you as a developer), the period may be shorter than expected and start repeating itself.</li>
<li><code>browserCrypto</code>: Utilizes <a href="https://developer.mozilla.org/en-US/docs/Web/API/window.crypto.getRandomValues"><code>crypto.getRandomValues(Int32Array)</code></a>. Only supported on newer browsers, but promises cryptographically random numbers.</li>
<li><code>nodeCrypto</code>: Utilizes <a href="https://nodejs.org/api/crypto.html#crypto_crypto_randombytes_size_callback">&lsquo;require('crypto&rsquo;).randomBytes(size)`</a>. Only supported on node.</li>
<li><code>MersenneTwister19937</code>: An implementation of the <a href="http://en.wikipedia.org/wiki/Mersenne_twister">Mersenne Twister</a> algorithm. Not cryptographically secure, but its results are repeatable. Must be seeded with a single integer or an array of integers or call <code>.autoSeed()</code> to automatically seed initial data. Guaranteed to produce consistent results across all JavaScript implementations assuming the same seed.</li>
</ul>
<p>One is also free to implement their own engine as long as it returns 32-bit integers, either signed or unsigned.</p>
<p>Some common, biased, <em>incorrect</em> tool for generating random integers is as follows: </p><pre class="fragment">// DO NOT USE, BIASED LOGIC
function randomInt(min, max) {
  return Math.floor(Math.random() * (max - min)) + min;
}
// DO NOT USE, BIASED LOGIC (typical C-like implementation)
function randomIntByModulo(min, max) {
  var i = (Math.random() * 32768) &gt;&gt;&gt; 0;
  return (i % (min - max)) + min;
}
</pre><p>The problem with both of these approaches is that the distribution of integers that it returns is not uniform. That is, it might be more biased to return <code>0</code> rather than <code>1</code>, making it inherently broken.</p>
<p><code>randomInt</code> may more evenly distribute its biased, but it is still wrong. <code>randomIntByModulo</code>, at least in the example given, is heavily biased to return [0, 67] over [68, 99].</p>
<p>In order to eliminate bias, sometimes the engine which random data is pulled from may need to be used more than once.</p>
<p>Random.js provides a series of distributions to alleviate this.</p>
<h1><a class="anchor" id="autotoc_md2110"></a>
API</h1>
<h2><a class="anchor" id="autotoc_md2111"></a>
Engines</h2>
<ul>
<li><code>nativeMath</code>: Utilizes <code>Math.random()</code></li>
<li><code>browserCrypto</code>: Utilizes <code>crypto.getRandomValues()</code></li>
<li><code>nodeCrypto</code>: Utilizes &lsquo;require('crypto&rsquo;).randomBytes()<code> -</code>MersenneTwister19937`: Produces a new Mersenne Twister. Must be seeded before use.</li>
</ul>
<p>Or you can make your own!</p>
<div class="fragment"><div class="line">interface Engine {</div>
<div class="line">  next(): number; // an int32</div>
<div class="line">}</div>
</div><!-- fragment --><p>Any object that fulfills that interface is an <code>Engine</code>.</p>
<h2><a class="anchor" id="autotoc_md2112"></a>
Mersenne Twister API</h2>
<ul>
<li><code>const mt = MersenneTwister19937.seed(value)</code>: Seed the twister with an initial 32-bit integer.</li>
<li><code>const mt = MersenneTwister19937.seedWithArray(array)</code>: Seed the twister with an array of 32-bit integers.</li>
<li><code>const mt = MersenneTwister19937.autoSeed()</code>: Seed the twister with automatic information. This uses the current Date and other entropy sources.</li>
<li><code>mt.next()</code>: Produce a 32-bit signed integer.</li>
<li><code>mt.discard(count)</code>: Discard <code>count</code> random values. More efficient than running <code>mt.next()</code> repeatedly.</li>
<li><code>mt.getUseCount()</code>: Return the number of times the engine has been used plus the number of discarded values.</li>
</ul>
<p>One can seed a Mersenne Twister with the same value (<code>MersenneTwister19937.seed(value)</code>) or values (<code>MersenneTwister19937.seedWithArray(array)</code>) and discard the number of uses (<code>mt.getUseCount()</code>) to achieve the exact same state.</p>
<p>If you wish to know the initial seed of <code>MersenneTwister19937.autoSeed()</code>, it is recommended to use the <code>createEntropy()</code> function to create the seed manually (this is what <code>autoSeed</code> does under-the-hood).</p>
<div class="fragment"><div class="line">const seed = createEntropy();</div>
<div class="line">const mt = MersenneTwister19937.seedWithArray(seed);</div>
<div class="line">useTwisterALot(mt); // you&#39;ll have to implement this yourself</div>
<div class="line">const clone = MersenneTwister19937.seedWithArray(seed).discard(</div>
<div class="line">  mt.getUseCount()</div>
<div class="line">);</div>
<div class="line">// at this point, `mt` and `clone` will produce equivalent values</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2113"></a>
Distributions</h2>
<p>Random.js also provides a set of methods for producing useful data from an engine.</p>
<ul>
<li><code>integer(min, max)(engine)</code>: Produce an integer within the inclusive range [<code>min</code>, <code>max</code>]. <code>min</code> can be at its minimum -9007199254740992 (-2 ** 53). <code>max</code> can be at its maximum 9007199254740992 (2 ** 53).</li>
<li><code>real(min, max, inclusive)(engine)</code>: Produce a floating point number within the range [<code>min</code>, <code>max</code>) or [<code>min</code>, <code>max</code>]. Uses 53 bits of randomness.</li>
<li><code>bool()(engine)</code>: Produce a boolean with a 50% chance of it being <code>true</code>.</li>
<li><code>bool(percentage)(engine)</code>: Produce a boolean with the specified chance causing it to be <code>true</code>.</li>
<li><code>bool(numerator, denominator)(engine)</code>: Produce a boolean with <code>numerator</code>/<code>denominator</code> chance of it being true.</li>
<li><code>pick(engine, array[, begin[, end]])</code>: Return a random value within the provided <code>array</code> within the sliced bounds of <code>begin</code> and <code>end</code>.</li>
<li><code>picker(array[, begin[, end]])(engine)</code>: Same as <code>pick(engine, array, begin, end)</code>.</li>
<li><code>shuffle(engine, array)</code>: Shuffle the provided <code>array</code> (in-place). Similar to <code>.sort()</code>.</li>
<li><code>sample(engine, population, sampleSize)</code>: From the <code>population</code> array, produce an array with <code>sampleSize</code> elements that are randomly chosen without repeats.</li>
<li><code>die(sideCount)(engine)</code>: Same as <code>integer(1, sideCount)(engine)</code></li>
<li><code>dice(sideCount, dieCount)(engine)</code>: Produce an array of length <code>dieCount</code> with as many <code>die</code> rolls.</li>
<li><code>uuid4(engine)</code>: Produce a <a href="http://en.wikipedia.org/wiki/Universally_unique_identifier">Universally Unique Identifier</a> Version 4.</li>
<li><code>string()(engine, length)</code>: Produce a random string using numbers, uppercase and lowercase letters, <code>_</code>, and <code>-</code> of length <code>length</code>.</li>
<li><code>string(pool)(engine, length)</code>: Produce a random string using the provided string <code>pool</code> as the possible characters to choose from of length <code>length</code>.</li>
<li><code>hex()(engine, length)</code> or <code>hex(false)(engine, length)</code>: Produce a random string comprised of numbers or the characters <code>abcdef</code> of length <code>length</code>.</li>
<li><code>hex(true)(engine, length)</code>: Produce a random string comprised of numbers or the characters <code>ABCDEF</code> of length <code>length</code>.</li>
<li><code>date(start, end)(engine)</code>: Produce a random <code>Date</code> within the inclusive range of [<code>start</code>, <code>end</code>]. <code>start</code> and <code>end</code> must both be <code>Date</code>s.</li>
</ul>
<p>An example of using <code>integer</code> would be as such:</p>
<div class="fragment"><div class="line">// create a Mersenne Twister-19937 that is auto-seeded based on time and other random values</div>
<div class="line">const engine = MersenneTwister19937.autoSeed();</div>
<div class="line">// create a distribution that will consistently produce integers within inclusive range [0, 99].</div>
<div class="line">const distribution = integer(0, 99);</div>
<div class="line">// generate a number that is guaranteed to be within [0, 99] without any particular bias.</div>
<div class="line">function generateNaturalLessThan100() {</div>
<div class="line">  return distribution(engine);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Producing a distribution should be considered a cheap operation, but producing a new Mersenne Twister can be expensive.</p>
<p>An example of producing a random SHA1 hash:</p>
<div class="fragment"><div class="line">// using essentially Math.random()</div>
<div class="line">var engine = nativeMath;</div>
<div class="line">// lower-case Hex string distribution</div>
<div class="line">var distribution = hex(false);</div>
<div class="line">// generate a 40-character hex string</div>
<div class="line">function generateSHA1() {</div>
<div class="line">  return distribution(engine, 40);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2114"></a>
Alternate API</h1>
<p>There is an alternate API which may be easier to use, but may be less performant. In scenarios where performance is paramount, it is recommended to use the aforementioned API.</p>
<div class="fragment"><div class="line">const random = new Random(</div>
<div class="line">  MersenneTwister19937.seedWithArray([0x12345678, 0x90abcdef])</div>
<div class="line">);</div>
<div class="line">const value = r.integer(0, 99);</div>
<div class="line"> </div>
<div class="line">const otherRandom = new Random(); // same as new Random(nativeMath)</div>
</div><!-- fragment --><p>This abstracts the concepts of engines and distributions.</p>
<ul>
<li><code>r.integer(min, max)</code>: Produce an integer within the inclusive range [<code>min</code>, <code>max</code>]. <code>min</code> can be at its minimum -9007199254740992 (2 ** 53). <code>max</code> can be at its maximum 9007199254740992 (2 ** 53). The special number <code>-0</code> is never returned.</li>
<li><code>r.real(min, max, inclusive)</code>: Produce a floating point number within the range [<code>min</code>, <code>max</code>) or [<code>min</code>, <code>max</code>]. Uses 53 bits of randomness.</li>
<li><code>r.bool()</code>: Produce a boolean with a 50% chance of it being <code>true</code>.</li>
<li><code>r.bool(percentage)</code>: Produce a boolean with the specified chance causing it to be <code>true</code>.</li>
<li><code>r.bool(numerator, denominator)</code>: Produce a boolean with <code>numerator</code>/<code>denominator</code> chance of it being true.</li>
<li><code>r.pick(array[, begin[, end]])</code>: Return a random value within the provided <code>array</code> within the sliced bounds of <code>begin</code> and <code>end</code>.</li>
<li><code>r.shuffle(array)</code>: Shuffle the provided <code>array</code> (in-place). Similar to <code>.sort()</code>.</li>
<li><code>r.sample(population, sampleSize)</code>: From the <code>population</code> array, produce an array with <code>sampleSize</code> elements that are randomly chosen without repeats.</li>
<li><code>r.die(sideCount)</code>: Same as <code>r.integer(1, sideCount)</code></li>
<li><code>r.dice(sideCount, dieCount)</code>: Produce an array of length <code>dieCount</code> with as many <code>die</code> rolls.</li>
<li><code>r.uuid4()</code>: Produce a <a href="http://en.wikipedia.org/wiki/Universally_unique_identifier">Universally Unique Identifier</a> Version 4.</li>
<li><code>r.string(length)</code>: Produce a random string using numbers, uppercase and lowercase letters, <code>_</code>, and <code>-</code> of length <code>length</code>.</li>
<li><code>r.string(length, pool)</code>: Produce a random string using the provided string <code>pool</code> as the possible characters to choose from of length <code>length</code>.</li>
<li><code>r.hex(length)</code> or <code>r.hex(length, false)</code>: Produce a random string comprised of numbers or the characters <code>abcdef</code> of length <code>length</code>.</li>
<li><code>r.hex(length, true)</code>: Produce a random string comprised of numbers or the characters <code>ABCDEF</code> of length <code>length</code>.</li>
<li><code>r.date(start, end)</code>: Produce a random <code>Date</code> within the inclusive range of [<code>start</code>, <code>end</code>]. <code>start</code> and <code>end</code> must both be <code>Date</code>s.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2115"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md2116"></a>
node.js</h2>
<p>In your project, run the following command:</p>
<div class="fragment"><div class="line">npm install random-js</div>
</div><!-- fragment --><p>or</p>
<div class="fragment"><div class="line">yarn add random-js</div>
</div><!-- fragment --><p>In your code:</p>
<div class="fragment"><div class="line">// ES6 Modules</div>
<div class="line">import { Random } from &quot;random-js&quot;;</div>
<div class="line">const random = new Random(); // uses the nativeMath engine</div>
<div class="line">const value = random.integer(1, 100);</div>
</div><!-- fragment --><div class="fragment"><div class="line">// CommonJS Modules</div>
<div class="line">const { Random } = require(&quot;random-js&quot;);</div>
<div class="line">const random = new Random(); // uses the nativeMath engine</div>
<div class="line">const value = random.integer(1, 100);</div>
</div><!-- fragment --><p>Or to have more control:</p>
<div class="fragment"><div class="line">const Random = require(&quot;random-js&quot;).Random;</div>
<div class="line">const random = new Random(MersenneTwister19937.autoSeed());</div>
<div class="line">const value = random.integer(1, 100);</div>
</div><!-- fragment --><p>It is recommended to create one shared engine and/or <code>Random</code> instance per-process rather than one per file.</p>
<h2><a class="anchor" id="autotoc_md2117"></a>
Browser using AMD or RequireJS</h2>
<p>Download <code>random.min.js</code> and place it in your project, then use one of the following patterns:</p>
<div class="fragment"><div class="line">define(function(require) {</div>
<div class="line">  var Random = require(&quot;random&quot;);</div>
<div class="line">  return new Random.Random(Random.MersenneTwister19937.autoSeed());</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">define(function(require) {</div>
<div class="line">  var Random = require(&quot;random&quot;);</div>
<div class="line">  return new Random.Random();</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">define([&quot;random&quot;], function(Random) {</div>
<div class="line">  return new Random.Random(Random.MersenneTwister19937.autoSeed());</div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2118"></a>
Browser using &lt;tt&gt;&lt;script&gt;&lt;/tt&gt; tag</h2>
<p>Download <code>random-js.min.js</code> and place it in your project, then add it as a <code>&lt;script&gt;</code> tag as such:</p>
<div class="fragment"><div class="line">&lt;script src=&quot;lib/random-js.min.js&quot;&gt;&lt;/script&gt;</div>
<div class="line">&lt;script&gt;</div>
<div class="line">  // Random is now available as a global (on the window object)</div>
<div class="line">  var random = new Random.Random();</div>
<div class="line">  alert(&quot;Random value from 1 to 100: &quot; + random.integer(1, 100));</div>
<div class="line">&lt;/script&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2119"></a>
Extending</h1>
<p>You can add your own methods to <code>Random</code> instances, as such:</p>
<div class="fragment"><div class="line">var random = new Random();</div>
<div class="line">random.bark = function() {</div>
<div class="line">  if (this.bool()) {</div>
<div class="line">    return &quot;arf!&quot;;</div>
<div class="line">  } else {</div>
<div class="line">    return &quot;woof!&quot;;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line">random.bark(); //=&gt; &quot;arf!&quot; or &quot;woof!&quot;</div>
</div><!-- fragment --><p>This is the recommended approach, especially if you only use one instance of <code>Random</code>.</p>
<p>Or you could even make your own subclass of Random:</p>
<div class="fragment"><div class="line">function MyRandom(engine) {</div>
<div class="line">  return Random.call(this, engine);</div>
<div class="line">}</div>
<div class="line">MyRandom.prototype = Object.create(Random.prototype);</div>
<div class="line">MyRandom.prototype.constructor = MyRandom;</div>
<div class="line">MyRandom.prototype.mood = function() {</div>
<div class="line">  switch (this.integer(0, 2)) {</div>
<div class="line">    case 0:</div>
<div class="line">      return &quot;Happy&quot;;</div>
<div class="line">    case 1:</div>
<div class="line">      return &quot;Content&quot;;</div>
<div class="line">    case 2:</div>
<div class="line">      return &quot;Sad&quot;;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line">var random = new MyRandom();</div>
<div class="line">random.mood(); //=&gt; &quot;Happy&quot;, &quot;Content&quot;, or &quot;Sad&quot;</div>
</div><!-- fragment --><p>Or, if you have a build tool are are in an ES6+ environment:</p>
<div class="fragment"><div class="line">class MyRandom extends Random {</div>
<div class="line">  mood() {</div>
<div class="line">    switch (this.integer(0, 2)) {</div>
<div class="line">      case 0:</div>
<div class="line">        return &quot;Happy&quot;;</div>
<div class="line">      case 1:</div>
<div class="line">        return &quot;Content&quot;;</div>
<div class="line">      case 2:</div>
<div class="line">        return &quot;Sad&quot;;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line">const random = new MyRandom();</div>
<div class="line">random.mood(); //=&gt; &quot;Happy&quot;, &quot;Content&quot;, or &quot;Sad&quot;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2120"></a>
Testing</h1>
<p>All the code in Random.js is fully tested and covered using <code>jest</code>.</p>
<p>To run tests in node.js:</p>
<div class="fragment"><div class="line">npm install</div>
<div class="line">npm test</div>
</div><!-- fragment --><p>or</p>
<div class="fragment"><div class="line">yarn install</div>
<div class="line">yarn test</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2121"></a>
License</h1>
<p>The MIT License (MIT).</p>
<p>See the LICENSE file in this project for more details. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
