<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fuzzuf: AFLplusplus (AFL++)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fuzzuf
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">AFLplusplus (AFL++) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md12281"></a>
Description</h1>
<p><a href="https://github.com/AFLplusplus/AFLplusplus">https://github.com/AFLplusplus/AFLplusplus</a></p>
<p>AFLplusplus[^woot20] is a superior fork to Google's (Michał Zalewski's) AFL, originally began as a collection of patches applicable to AFL v2.52b, which had become inactive at then.</p>
<p>After Zalewski released AFL v2.52b in 2017 and stopped updating, lots of community-provided patches have been published for fixes and enhancements (e.g. llvm-mode fixes and qemu-mode optimization). However, some of them conflicted when applied together since they are based on the same origin, and sometimes tried to overwrite the same line. Marc Heuse started merging them into one single repository as AFLplusplus in 2019 with Marcel Böhme's AFLFast patch[^group-uqRFf7rmCQAJ] [^group-jSNsWNmPCAAJ].</p>
<p>As it got updated, Heuse and developer team did not only enhanced existing features, but also adopted new ones including multi-architecture support, more ways to perform binary-only fuzzing, new mutators and instrumentations proposed in academic papers, and so on.</p>
<p>fuzzuf currently adopts fuzzer-side enhancements in AFLplusplus only. That is, compiler-side enhancements (e.g. NeverZero) are not included.</p>
<h1><a class="anchor" id="autotoc_md12282"></a>
List of enhanced features</h1>
<h2><a class="anchor" id="autotoc_md12283"></a>
FAST3</h2>
<p>Originally provided as a patch to improve scheduling (a way to compute seed's score) for AFLplusplus by Marcel Böhme (an author of AFLFast) in <a href="https://github.com/AFLplusplus/AFLplusplus/commit/e87eca7f">AFLplusplus/AFLplusplus@e87eca7f</a> (later improved by AFLplusplus developers).</p>
<p>Before the PR was made, there were some experiments done on fuzzbench to compare the performance among several parameter tunings. It seems the adopted one is a something between schedulings called fast3 and fast4.</p>
<p>Moreover, the patch changes <code>n_fuzz</code> from u32 in <code>struct <a class="el" href="structqueue__entry.html">queue_entry</a></code> (which is equivalent to <code>Testcase</code> in fuzzuf) to an array of u32 in <code>struct afl_state</code> (equivalent to <code>AFLState</code> in fuzzuf), and <code><a class="el" href="structqueue__entry.html">queue_entry</a></code> now holds <code>n_fuzz_entry</code>, which is an index number for that array. <br  />
 This is to resolve the performance bottleneck where AFL++ tried to match checksum in a while-loop naively.</p>
<p>fuzzuf's implementation fixed two possible bugs:</p>
<ul>
<li>div by zero in LIN and QUAD schedulings</li>
<li>division done in <code>u32</code>, not in <code>double</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md12284"></a>
more_havoc</h2>
<p>They also added several new mutations to havoc with their probability to be chosen. It is unclear what that probability is based on.</p>
<p>The first change occurred in <a href="https://github.com/AFLplusplus/AFLplusplus/commit/70bf4b4a">AFLplusplus/AFLplusplus@70bf4b4a</a> as <code>havoc2</code> (a name of the merged branch) to change the uniform probability of mutations to make them have their own values.</p>
<p>Nextly, new mutations came in at <a href="https://github.com/AFLplusplus/AFLplusplus/commit/b8e61da8">AFLplusplus/AFLplusplus@b8e61da8</a> as <code>more_havoc</code>. This PR reflects those probabilities with Walker's alias distribution.</p>
<h2><a class="anchor" id="autotoc_md12285"></a>
Weighted random seed selection</h2>
<p>Although the original AFL selects its seeds sequentially, it was pointed out that choosing them randomly produces a better fuzzing result.</p>
<p>AFL++ adopted a random seed selection with Walker's alias method at <a href="https://github.com/AFLplusplus/AFLplusplus/commit/6a397d61">AFLplusplus/AFLplusplus@6a397d61</a>. At this point, weights (values) used to create the alias table are based on the conventional <code>calculate_score()</code> function.</p>
<p>Thereafter, a patch by Marcel Böhme (<a href="https://github.com/AFLplusplus/AFLplusplus/commit/06ec5ab3">AFLplusplus/AFLplusplus@06ec5ab3</a>) changed AFL++ to use the new <code>compute_weight</code> function to create it. The purpose of this patch was: </p><blockquote class="doxtable">
<p>This commit extends the weight-based sampling by assigning weights based on how often the seed's path is exercised, the number of branches it covers, and the time it takes to execute. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md12286"></a>
CLI usage</h1>
<p>Just like fuzzuf's AFL or AFLFast, you can use AFL-like syntax on CLI on fuzzuf-AFLplusplus. So we're not going explain the common options here again.</p>
<p>To start a fuzzing from CLI, execute the following in your shell:</p>
<div class="fragment"><div class="line">cd /path/to/fuzzuf</div>
<div class="line">cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_ALGORITHMS=aflplusplus # add other algos if you want</div>
<div class="line">cmake --build build -j $(nproc)</div>
<div class="line">./build/fuzzuf aflplusplus -i /path/to/input_dir/ -- /path/to/PUT @@</div>
</div><!-- fragment --><p>AFLplusplus's local options currently implemented are follows:</p>
<ul>
<li><code>-D [ --det ]</code>: Enable deterministic stages (AFLplusplus skips them by default to gain its performance)</li>
<li><code>-p [ --schedule ]</code> arg (=fast): Select power schedule to use (default to FAST). You must specify in a lowercase string which is one of <b>fast, coe, explore, lin, quad, exploit</b>. <br  />
</li>
</ul>
<p>For example, to enable deterministic mutation stages and choose the <code>COE</code> seed scheduling, do the following:</p>
<div class="fragment"><div class="line">./build/fuzzuf aflplusplus -i /path/to/input_dir/ -D -p coe -- /path/to/PUT @@</div>
</div><!-- fragment --><p>[^woot20]: <a href="https://aflplus.plus/papers/aflpp-woot2020.pdf">AFL++: Combining Incremental Steps of Fuzzing Research</a></p>
<p>[^group-uqRFf7rmCQAJ]: <a href="https://groups.google.com/g/afl-users/c/9WFfQqNS6qk/m/uqRFf7rmCQAJ">Fix for QEMU install memfd issues on glibc 2.27</a></p>
<p>[^group-jSNsWNmPCAAJ]: <a href="https://groups.google.com/g/afl-users/c/dvSou7uT2Qs/m/jSNsWNmPCAAJ">afl++ is now available</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
