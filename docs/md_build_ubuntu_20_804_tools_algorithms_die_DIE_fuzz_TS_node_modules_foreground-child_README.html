<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fuzzuf: foreground-child</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fuzzuf
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">foreground-child </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Run a child as if it's the foreground process. Give it stdio. Exit when it exits.</p>
<p>Mostly this module is here to support some use cases around wrapping child processes for test coverage and such. But it's also generally useful any time you want one program to execute another as if it's the "main" process, for example, if a program takes a <code>--cmd</code> argument to execute in some way.</p>
<h1><a class="anchor" id="autotoc_md1864"></a>
USAGE</h1>
<div class="fragment"><div class="line">import { foregroundChild } from &#39;foreground-child&#39;</div>
<div class="line">// hybrid module, this also works:</div>
<div class="line">// const { foregroundChild } = require(&#39;foreground-child&#39;)</div>
<div class="line"> </div>
<div class="line">// cats out this file</div>
<div class="line">const child = foregroundChild(&#39;cat&#39;, [__filename])</div>
<div class="line"> </div>
<div class="line">// At this point, it&#39;s best to just do nothing else.</div>
<div class="line">// return or whatever.</div>
<div class="line">// If the child gets a signal, or just exits, then this</div>
<div class="line">// parent process will exit in the same way.</div>
</div><!-- fragment --><p>You can provide custom spawn options by passing an object after the program and arguments:</p>
<div class="fragment"><div class="line">const child = foregroundChild(`cat ${__filename}`, { shell: true })</div>
</div><!-- fragment --><p>A callback can optionally be provided, if you want to perform an action before your foreground-child exits:</p>
<div class="fragment"><div class="line">const child = foregroundChild(&#39;cat&#39;, [__filename], spawnOptions, () =&gt; {</div>
<div class="line">  doSomeActions()</div>
<div class="line">})</div>
</div><!-- fragment --><p>The callback can return a Promise in order to perform asynchronous actions. If the callback does not return a promise, then it must complete its actions within a single JavaScript tick.</p>
<div class="fragment"><div class="line">const child = foregroundChild(&#39;cat&#39;, [__filename], async () =&gt; {</div>
<div class="line">  await doSomeAsyncActions()</div>
<div class="line">})</div>
</div><!-- fragment --><p>If the callback throws or rejects, then it will be unhandled, and node will exit in error.</p>
<p>If the callback returns a string value, then that will be used as the signal to exit the parent process. If it returns a number, then that number will be used as the parent exit status code. If it returns boolean <code>false</code>, then the parent process will not be terminated. If it returns <code>undefined</code>, then it will exit with the same signal/code as the child process.</p>
<h1><a class="anchor" id="autotoc_md1865"></a>
Caveats</h1>
<p>The "normal" standard IO file descriptors (0, 1, and 2 for stdin, stdout, and stderr respectively) are shared with the child process. Additionally, if there is an IPC channel set up in the parent, then messages are proxied to the child on file descriptor 3.</p>
<p>In Node, it's possible to also map arbitrary file descriptors into a child process. In these cases, foreground-child will not map the file descriptors into the child. If file descriptors 0, 1, or 2 are used for the IPC channel, then strange behavior may happen (like printing IPC messages to stderr, for example).</p>
<p>Note that a SIGKILL will always kill the parent process, but will not proxy the signal to the child process, because SIGKILL cannot be caught. In order to address this, a special "watchdog" child process is spawned which will send a SIGKILL to the child process if it does not terminate within half a second after the watchdog receives a SIGHUP due to its parent terminating.</p>
<p>On Windows, issuing a <code>process.kill(process.pid, signal)</code> with a fatal termination signal may cause the process to exit with a <code>1</code> status code rather than reporting the signal properly. This module tries to do the right thing, but on Windows systems, you may see that incorrect result. There is as far as I'm aware no workaround for this. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
