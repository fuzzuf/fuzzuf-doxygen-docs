<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fuzzuf: npm-profile</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fuzzuf
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">npm-profile </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Provides functions for fetching and updating an npmjs.com profile.</p>
<div class="fragment"><div class="line">const profile = require(&#39;npm-profile&#39;)</div>
<div class="line">const result = await profile.get(registry, {token})</div>
<div class="line">//...</div>
</div><!-- fragment --><p>The API that this implements is documented here:</p>
<ul>
<li><a href="https://github.com/npm/registry/blob/master/docs/user/authentication.md">authentication</a></li>
<li><a href="https://github.com/npm/registry/blob/master/docs/user/profile.md">profile editing</a> (and two-factor authentication)</li>
</ul>
<h1><a class="anchor" id="autotoc_md8759"></a>
Table of Contents</h1>
<ul>
<li><a href="#api">API</a><ul>
<li>Login and Account Creation<ul>
<li><a href="#adduser"><code>adduser()</code></a></li>
<li><a href="#login"><code>login()</code></a></li>
<li><a href="#adduser-web"><code>adduserWeb()</code></a></li>
<li><a href="#login-web"><code>loginWeb()</code></a></li>
<li><a href="#adduser-couch"><code>adduserCouch()</code></a></li>
<li><a href="#login-couch"><code>loginCouch()</code></a></li>
</ul>
</li>
<li>Profile Data Management<ul>
<li><a href="#get"><code>get()</code></a></li>
<li><a href="#set"><code>set()</code></a></li>
</ul>
</li>
<li>Token Management<ul>
<li><a href="#list-tokens"><code>listTokens()</code></a></li>
<li><a href="#remove-token"><code>removeToken()</code></a></li>
<li><a href="#create-token"><code>createToken()</code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md8760"></a>
API</h1>
<h2><a class="anchor" id="autotoc_md8761"></a>
&lt;a name="adduser"&gt;&lt;/a&gt; &lt;tt&gt;&gt; profile.adduser(opener, prompter, [opts]) → Promise&lt;/tt&gt;</h2>
<p>Tries to create a user new web based login, if that fails it falls back to using the legacy CouchDB APIs.</p>
<ul>
<li><code>opener</code> Function (url) → Promise, returns a promise that resolves after a browser has been opened for the user at <code>url</code>.</li>
<li><code>prompter</code> Function (creds) → Promise, returns a promise that resolves to an object with <code>username</code>, <code>email</code> and <code>password</code> properties.</li>
<li><a href="#opts"><code>opts</code></a> Object (optional) plus extra keys:<ul>
<li><code>creds</code> Object, passed through to prompter, common values are:<ul>
<li><code>username</code> String, default value for username</li>
<li><code>email</code> String, default value for email</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md8762"></a>
&lt;strong&gt;Promise Value&lt;/strong&gt;</h3>
<p>An object with the following properties:</p>
<ul>
<li><code>token</code> String, to be used to authenticate further API calls</li>
<li><code>username</code> String, the username the user authenticated as</li>
</ul>
<h3><a class="anchor" id="autotoc_md8763"></a>
&lt;strong&gt;Promise Rejection&lt;/strong&gt;</h3>
<p>An error object indicating what went wrong.</p>
<p>The <code>headers</code> property will contain the HTTP headers of the response.</p>
<p>If the action was denied because it came from an IP address that this action on this account isn't allowed from then the <code>code</code> will be set to <code>EAUTHIP</code>.</p>
<p>Otherwise the code will be &lsquo;'E&rsquo;<code>followed by the HTTP response code, for example a Forbidden response would be</code>E403`.</p>
<h2><a class="anchor" id="autotoc_md8764"></a>
&lt;a name="login"&gt;&lt;/a&gt; &lt;tt&gt;&gt; profile.login(opener, prompter, [opts]) → Promise&lt;/tt&gt;</h2>
<p>Tries to login using new web based login, if that fails it falls back to using the legacy CouchDB APIs.</p>
<ul>
<li><code>opener</code> Function (url) → Promise, returns a promise that resolves after a browser has been opened for the user at <code>url</code>.</li>
<li><code>prompter</code> Function (creds) → Promise, returns a promise that resolves to an object with <code>username</code>, and <code>password</code> properties.</li>
<li><a href="#opts"><code>opts</code></a> Object (optional) plus extra keys:<ul>
<li><code>creds</code> Object, passed through to prompter, common values are:<ul>
<li><code>name</code> String, default value for username</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md8765"></a>
&lt;strong&gt;Promise Value&lt;/strong&gt;</h3>
<p>An object with the following properties:</p>
<ul>
<li><code>token</code> String, to be used to authenticate further API calls</li>
<li><code>username</code> String, the username the user authenticated as</li>
</ul>
<h3><a class="anchor" id="autotoc_md8766"></a>
&lt;strong&gt;Promise Rejection&lt;/strong&gt;</h3>
<p>An error object indicating what went wrong.</p>
<p>The <code>headers</code> property will contain the HTTP headers of the response.</p>
<p>If the action was denied because an OTP is required then <code>code</code> will be set to <code>EOTP</code>. This error code can only come from a legacy CouchDB login and so this should be retried with loginCouch.</p>
<p>If the action was denied because it came from an IP address that this action on this account isn't allowed from then the <code>code</code> will be set to <code>EAUTHIP</code>.</p>
<p>Otherwise the code will be &lsquo;'E&rsquo;<code>followed by the HTTP response code, for example a Forbidden response would be</code>E403`.</p>
<h2><a class="anchor" id="autotoc_md8767"></a>
&lt;a name="adduser-web"&gt;&lt;/a&gt; &lt;tt&gt;&gt; profile.adduserWeb(opener, [opts]) → Promise&lt;/tt&gt;</h2>
<p>Tries to create a user new web based login, if that fails it falls back to using the legacy CouchDB APIs.</p>
<ul>
<li><code>opener</code> Function (url) → Promise, returns a promise that resolves after a browser has been opened for the user at <code>url</code>.</li>
<li><a href="#opts"><code>opts</code></a> Object</li>
</ul>
<h3><a class="anchor" id="autotoc_md8768"></a>
&lt;strong&gt;Promise Value&lt;/strong&gt;</h3>
<p>An object with the following properties:</p>
<ul>
<li><code>token</code> String, to be used to authenticate further API calls</li>
<li><code>username</code> String, the username the user authenticated as</li>
</ul>
<h3><a class="anchor" id="autotoc_md8769"></a>
&lt;strong&gt;Promise Rejection&lt;/strong&gt;</h3>
<p>An error object indicating what went wrong.</p>
<p>The <code>headers</code> property will contain the HTTP headers of the response.</p>
<p>If the registry does not support web-login then an error will be thrown with its <code>code</code> property set to <code>ENYI</code> . You should retry with <code>adduserCouch</code>. If you use <code>adduser</code> then this fallback will be done automatically.</p>
<p>If the action was denied because it came from an IP address that this action on this account isn't allowed from then the <code>code</code> will be set to <code>EAUTHIP</code>.</p>
<p>Otherwise the code will be &lsquo;'E&rsquo;<code>followed by the HTTP response code, for example a Forbidden response would be</code>E403`.</p>
<h2><a class="anchor" id="autotoc_md8770"></a>
&lt;a name="login-web"&gt;&lt;/a&gt; &lt;tt&gt;&gt; profile.loginWeb(opener, [opts]) → Promise&lt;/tt&gt;</h2>
<p>Tries to login using new web based login, if that fails it falls back to using the legacy CouchDB APIs.</p>
<ul>
<li><code>opener</code> Function (url) → Promise, returns a promise that resolves after a browser has been opened for the user at <code>url</code>.</li>
<li><a href="#opts"><code>opts</code></a> Object (optional)</li>
</ul>
<h3><a class="anchor" id="autotoc_md8771"></a>
&lt;strong&gt;Promise Value&lt;/strong&gt;</h3>
<p>An object with the following properties:</p>
<ul>
<li><code>token</code> String, to be used to authenticate further API calls</li>
<li><code>username</code> String, the username the user authenticated as</li>
</ul>
<h3><a class="anchor" id="autotoc_md8772"></a>
&lt;strong&gt;Promise Rejection&lt;/strong&gt;</h3>
<p>An error object indicating what went wrong.</p>
<p>The <code>headers</code> property will contain the HTTP headers of the response.</p>
<p>If the registry does not support web-login then an error will be thrown with its <code>code</code> property set to <code>ENYI</code> . You should retry with <code>loginCouch</code>. If you use <code>login</code> then this fallback will be done automatically.</p>
<p>If the action was denied because it came from an IP address that this action on this account isn't allowed from then the <code>code</code> will be set to <code>EAUTHIP</code>.</p>
<p>Otherwise the code will be &lsquo;'E&rsquo;<code>followed by the HTTP response code, for example a Forbidden response would be</code>E403`.</p>
<h2><a class="anchor" id="autotoc_md8773"></a>
&lt;a name="adduser-couch"&gt;&lt;/a&gt; &lt;tt&gt;&gt; profile.adduserCouch(username, email, password, [opts]) → Promise&lt;/tt&gt;</h2>
<div class="fragment"><div class="line">const {token} = await profile.adduser(username, email, password, {registry})</div>
<div class="line">// `token` can be passed in through `opts` for authentication.</div>
</div><!-- fragment --><p>Creates a new user on the server along with a fresh bearer token for future authentication as this user. This is what you see as an <code>authToken</code> in an <code>.npmrc</code>.</p>
<p>If the user already exists then the npm registry will return an error, but this is registry specific and not guaranteed.</p>
<ul>
<li><code>username</code> String</li>
<li><code>email</code> String</li>
<li><code>password</code> String</li>
<li><a href="#opts"><code>opts</code></a> Object (optional)</li>
</ul>
<h3><a class="anchor" id="autotoc_md8774"></a>
&lt;strong&gt;Promise Value&lt;/strong&gt;</h3>
<p>An object with the following properties:</p>
<ul>
<li><code>token</code> String, to be used to authenticate further API calls</li>
<li><code>username</code> String, the username the user authenticated as</li>
</ul>
<h3><a class="anchor" id="autotoc_md8775"></a>
&lt;strong&gt;Promise Rejection&lt;/strong&gt;</h3>
<p>An error object indicating what went wrong.</p>
<p>The <code>headers</code> property will contain the HTTP headers of the response.</p>
<p>If the action was denied because an OTP is required then <code>code</code> will be set to <code>EOTP</code>.</p>
<p>If the action was denied because it came from an IP address that this action on this account isn't allowed from then the <code>code</code> will be set to <code>EAUTHIP</code>.</p>
<p>Otherwise the code will be &lsquo;'E&rsquo;<code>followed by the HTTP response code, for example a Forbidden response would be</code>E403`.</p>
<h2><a class="anchor" id="autotoc_md8776"></a>
&lt;a name="login-couch"&gt;&lt;/a&gt; &lt;tt&gt;&gt; profile.loginCouch(username, password, [opts]) → Promise&lt;/tt&gt;</h2>
<div class="fragment"><div class="line">let token</div>
<div class="line">try {</div>
<div class="line">  {token} = await profile.login(username, password, {registry})</div>
<div class="line">} catch (err) {</div>
<div class="line">  if (err.code === &#39;otp&#39;) {</div>
<div class="line">    const otp = await getOTPFromSomewhere()</div>
<div class="line">    {token} = await profile.login(username, password, {otp})</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line">// `token` can now be passed in through `opts` for authentication.</div>
</div><!-- fragment --><p>Logs you into an existing user. Does not create the user if they do not already exist. Logging in means generating a new bearer token for use in future authentication. This is what you use as an <code>authToken</code> in an <code>.npmrc</code>.</p>
<ul>
<li><code>username</code> String</li>
<li><code>email</code> String</li>
<li><code>password</code> String</li>
<li><a href="#opts"><code>opts</code></a> Object (optional)</li>
</ul>
<h3><a class="anchor" id="autotoc_md8777"></a>
&lt;strong&gt;Promise Value&lt;/strong&gt;</h3>
<p>An object with the following properties:</p>
<ul>
<li><code>token</code> String, to be used to authenticate further API calls</li>
<li><code>username</code> String, the username the user authenticated as</li>
</ul>
<h3><a class="anchor" id="autotoc_md8778"></a>
&lt;strong&gt;Promise Rejection&lt;/strong&gt;</h3>
<p>An error object indicating what went wrong.</p>
<p>If the object has a <code>code</code> property set to <code>EOTP</code> then that indicates that this account must use two-factor authentication to login. Try again with a one-time password.</p>
<p>If the object has a <code>code</code> property set to <code>EAUTHIP</code> then that indicates that this account is only allowed to login from certain networks and this ip is not on one of those networks.</p>
<p>If the error was neither of these then the error object will have a <code>code</code> property set to the HTTP response code and a <code>headers</code> property with the HTTP headers in the response.</p>
<h2><a class="anchor" id="autotoc_md8779"></a>
&lt;a name="get"&gt;&lt;/a&gt; &lt;tt&gt;&gt; profile.get([opts]) → Promise&lt;/tt&gt;</h2>
<div class="fragment"><div class="line">const {name, email} = await profile.get({token})</div>
<div class="line">console.log(`${token} belongs to https://npm.im/~${name}, (mailto:${email})`)</div>
</div><!-- fragment --><p>Fetch profile information for the authenticated user.</p>
<ul>
<li><a href="#opts"><code>opts</code></a> Object</li>
</ul>
<h3><a class="anchor" id="autotoc_md8780"></a>
&lt;strong&gt;Promise Value&lt;/strong&gt;</h3>
<p>An object that looks like this:</p>
<div class="fragment"><div class="line">// &quot;*&quot; indicates a field that may not always appear</div>
<div class="line">{</div>
<div class="line">  tfa: null |</div>
<div class="line">       false |</div>
<div class="line">       {&quot;mode&quot;: &quot;auth-only&quot;, pending: Boolean} |</div>
<div class="line">       [&quot;recovery&quot;, &quot;codes&quot;] |</div>
<div class="line">       &quot;otpauth://...&quot;,</div>
<div class="line">  name: String,</div>
<div class="line">  email: String,</div>
<div class="line">  email_verified: Boolean,</div>
<div class="line">  created: Date,</div>
<div class="line">  updated: Date,</div>
<div class="line">  cidr_whitelist: null | [&quot;192.168.1.1/32&quot;, ...],</div>
<div class="line">  fullname: String, // *</div>
<div class="line">  homepage: String, // *</div>
<div class="line">  freenode: String, // *</div>
<div class="line">  twitter: String,  // *</div>
<div class="line">  github: String    // *</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8781"></a>
&lt;strong&gt;Promise Rejection&lt;/strong&gt;</h3>
<p>An error object indicating what went wrong.</p>
<p>The <code>headers</code> property will contain the HTTP headers of the response.</p>
<p>If the action was denied because an OTP is required then <code>code</code> will be set to <code>EOTP</code>.</p>
<p>If the action was denied because it came from an IP address that this action on this account isn't allowed from then the <code>code</code> will be set to <code>EAUTHIP</code>.</p>
<p>Otherwise the code will be the HTTP response code.</p>
<h2><a class="anchor" id="autotoc_md8782"></a>
&lt;a name="set"&gt;&lt;/a&gt; &lt;tt&gt;&gt; profile.set(profileData, [opts]) → Promise&lt;/tt&gt;</h2>
<div class="fragment"><div class="line">await profile.set({github: &#39;great-github-account-name&#39;}, {token})</div>
</div><!-- fragment --><p>Update profile information for the authenticated user.</p>
<ul>
<li><code>profileData</code> An object, like that returned from <code>profile.get</code>, but see below for caveats relating to <code>password</code>, <code>tfa</code> and <code>cidr_whitelist</code>.</li>
<li><a href="#opts"><code>opts</code></a> Object (optional)</li>
</ul>
<h3><a class="anchor" id="autotoc_md8783"></a>
&lt;strong&gt;SETTING &lt;tt&gt;password&lt;/tt&gt;&lt;/strong&gt;</h3>
<p>This is used to change your password and is not visible (for obvious reasons) through the <code>get()</code> API. The value should be an object with <code>old</code> and <code>new</code> properties, where the former has the user's current password and the latter has the desired new password. For example</p>
<div class="fragment"><div class="line">await profile.set({</div>
<div class="line">  password: {</div>
<div class="line">    old: &#39;abc123&#39;,</div>
<div class="line">    new: &#39;my new (more secure) password&#39;</div>
<div class="line">  }</div>
<div class="line">}, {token})</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8784"></a>
&lt;strong&gt;SETTING &lt;tt&gt;cidr_whitelist&lt;/tt&gt;&lt;/strong&gt;</h3>
<p>The value for this is an Array. Only valid CIDR ranges are allowed in it. Be very careful as it's possible to lock yourself out of your account with this. This is not currently exposed in <code>npm</code> itself.</p>
<div class="fragment"><div class="line">await profile.set({</div>
<div class="line">  cidr_whitelist: [ &#39;8.8.8.8/32&#39; ]</div>
<div class="line">}, {token})</div>
<div class="line">// ↑ only one of google&#39;s dns servers can now access this account.</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8785"></a>
&lt;strong&gt;SETTING &lt;tt&gt;tfa&lt;/tt&gt;&lt;/strong&gt;</h3>
<p>Enabling two-factor authentication is a multi-step process.</p>
<ol type="1">
<li>Call <code>profile.get</code> and check the status of <code>tfa</code>. If <code>pending</code> is true then you'll need to disable it with &lsquo;profile.set({tfa: {password, mode: 'disable&rsquo;}, …)<code>. 2.</code>profile.set({tfa: {password, mode}}, {registry, token})<code><ul>
<li>Note that the user'spassword<code>is required here in the</code>tfa` object, regardless of how you're authenticating.</li>
<li><code>mode</code> is either <code>auth-only</code> which requires an <code>otp</code> when calling <code>login</code> or <code>createToken</code>, or <code>mode</code> is <code>auth-and-writes</code> and an <code>otp</code> will be required on login, publishing or when granting others access to your modules.</li>
<li>Be aware that this set call may require otp as part of the auth object. If otp is needed it will be indicated through a rejection in the usual way.</li>
</ul>
</code></li>
<li><code>If tfa was already enabled then you're just switch modes and a successful response means that you're done. If the tfa property is empty and tfa <em>wasn't</em> enabled then it means they were in a pending state.</code></li>
</ol>
<ol type="1">
<li><code>The response will have a <code>tfa</code> property set to an <code>otpauth</code> URL, as <a href="https://github.com/google/google-authenticator/wiki/Key-Uri-Format">used by Google Authenticator</a>. You will need to show this to the user for them to add to their authenticator application. This is typically done as a QRCODE, but you can also show the value of the <code>secret</code> key in the <code>otpauth</code> query string and they can type or copy paste that in.</code></li>
<li><code>To complete setting up two factor auth you need to make a second call to <code>profile.set</code> with <code>tfa</code> set to an array of TWO codes from the user's authenticator, eg: <code>profile.set(tfa: [otp1, otp2]}, {registry, token})</code></code></li>
<li><code>On success you'll get a result object with a <code>tfa</code> property that has an array of one-time-use recovery codes. These are used to authenticate later if the second factor is lost and generally should be printed and put somewhere safe.</code></li>
</ol>
<p><code>Disabling two-factor authentication is more straightforward, set the <code>tfa</code> attribute to an object with a <code>password</code> property and a <code>mode</code> of <code>disable</code>.</code></p>
<p><code></p><div class="fragment"><div class="line">await profile.set({tfa: {password, mode: &#39;disable&#39;}}, {token})</div>
</div><!-- fragment --><p></code></p>
<p><code></code></p>
<h3><a class="anchor" id="autotoc_md8786"></a>
&lt;strong&gt;Promise Value&lt;/strong&gt;</h3>
<p><code> An object reflecting the changes you made, see description for <code>profile.get</code>.</code></p>
<p><code></code></p>
<h3><a class="anchor" id="autotoc_md8787"></a>
&lt;strong&gt;Promise Rejection&lt;/strong&gt;</h3>
<p><code> An error object indicating what went wrong.</code></p>
<p><code>The <code>headers</code> property will contain the HTTP headers of the response.</code></p>
<p><code>If the action was denied because an OTP is required then <code>code</code> will be set to <code>EOTP</code>.</code></p>
<p><code>If the action was denied because it came from an IP address that this action on this account isn't allowed from then the <code>code</code> will be set to <code>EAUTHIP</code>.</code></p>
<p><code>Otherwise the code will be the HTTP response code.</code></p>
<p><code></code></p>
<h2><a class="anchor" id="autotoc_md8788"></a>
&lt;a name="list-tokens"&gt;&lt;/a&gt; &lt;tt&gt;&gt; profile.listTokens([opts]) → Promise&lt;/tt&gt;</h2>
<p><code> </p><div class="fragment"><div class="line">const tokens = await profile.listTokens({registry, token})</div>
<div class="line">console.log(`Number of tokens in your accounts: ${tokens.length}`)</div>
</div><!-- fragment --><p></code></p>
<p><code>Fetch a list of all of the authentication tokens the authenticated user has.</code></p>
<p><code></p><ul>
<li><a href="#opts"><code>opts</code></a> Object (optional)</li>
</ul>
<p></code></p>
<p><code></code></p>
<h3><a class="anchor" id="autotoc_md8789"></a>
&lt;strong&gt;Promise Value&lt;/strong&gt;</h3>
<p><code> An array of token objects. Each token object has the following properties:</code></p>
<p><code></p><ul>
<li>key — A sha512 that can be used to remove this token.</li>
<li>token — The first six characters of the token UUID. This should be used by the user to identify which token this is.</li>
<li>created — The date and time the token was created</li>
<li>readonly — If true, this token can only be used to download private modules. Critically, it CAN NOT be used to publish.</li>
<li>cidr_whitelist — An array of CIDR ranges that this token is allowed to be used from.</li>
</ul>
<p></code></p>
<p><code></code></p>
<h3><a class="anchor" id="autotoc_md8790"></a>
&lt;strong&gt;Promise Rejection&lt;/strong&gt;</h3>
<p><code> An error object indicating what went wrong.</code></p>
<p><code>The <code>headers</code> property will contain the HTTP headers of the response.</code></p>
<p><code>If the action was denied because an OTP is required then <code>code</code> will be set to <code>EOTP</code>.</code></p>
<p><code>If the action was denied because it came from an IP address that this action on this account isn't allowed from then the <code>code</code> will be set to <code>EAUTHIP</code>.</code></p>
<p><code>Otherwise the code will be the HTTP response code.</code></p>
<p><code></code></p>
<h2><a class="anchor" id="autotoc_md8791"></a>
&lt;a name="remove-token"&gt;&lt;a&gt; &lt;tt&gt;&gt; profile.removeToken(token|key, opts) → Promise&lt;/tt&gt;</h2>
<p><code> </p><div class="fragment"><div class="line">await profile.removeToken(key, {token})</div>
<div class="line">// token is gone!</div>
</div><!-- fragment --><p></code></p>
<p><code>Remove a specific authentication token.</code></p>
<p><code></p><ul>
<li><code>token|key</code> String, either a complete authentication token or the key returned by <code>profile.listTokens</code>.</li>
<li><a href="#opts"><code>opts</code></a> Object (optional)</li>
</ul>
<p></code></p>
<p><code></code></p>
<h3><a class="anchor" id="autotoc_md8792"></a>
&lt;strong&gt;Promise Value&lt;/strong&gt;</h3>
<p><code> No value.</code></p>
<p><code></code></p>
<h3><a class="anchor" id="autotoc_md8793"></a>
&lt;strong&gt;Promise Rejection&lt;/strong&gt;</h3>
<p><code> An error object indicating what went wrong.</code></p>
<p><code>The <code>headers</code> property will contain the HTTP headers of the response.</code></p>
<p><code>If the action was denied because an OTP is required then <code>code</code> will be set to <code>EOTP</code>.</code></p>
<p><code>If the action was denied because it came from an IP address that this action on this account isn't allowed from then the <code>code</code> will be set to <code>EAUTHIP</code>.</code></p>
<p><code>Otherwise the code will be the HTTP response code.</code></p>
<p><code></code></p>
<h2><a class="anchor" id="autotoc_md8794"></a>
&lt;a name="create-token"&gt;&lt;/a&gt; &lt;tt&gt;&gt; profile.createToken(password, readonly, cidr_whitelist, [opts]) → Promise&lt;/tt&gt;</h2>
<p><code> </p><div class="fragment"><div class="line">const newToken = await profile.createToken(</div>
<div class="line">  password, readonly, cidr_whitelist, {token, otp}</div>
<div class="line">)</div>
<div class="line">// do something with the newToken</div>
</div><!-- fragment --><p></code></p>
<p><code>Create a new authentication token, possibly with restrictions.</code></p>
<p><code></p><ul>
<li><code>password</code> String</li>
<li><code>readonly</code> Boolean</li>
<li><code>cidr_whitelist</code> Array</li>
<li><a href="#opts"><code>opts</code></a> Object Optional</li>
</ul>
<p></code></p>
<p><code></code></p>
<h3><a class="anchor" id="autotoc_md8795"></a>
&lt;strong&gt;Promise Value&lt;/strong&gt;</h3>
<p><code> The promise will resolve with an object very much like the one's returned by <code>profile.listTokens</code>. The only difference is that <code>token</code> is not truncated.</code></p>
<p><code></p><div class="fragment"><div class="line">{</div>
<div class="line">  token: String,</div>
<div class="line">  key: String,    // sha512 hash of the token UUID</div>
<div class="line">  cidr_whitelist: [String],</div>
<div class="line">  created: Date,</div>
<div class="line">  readonly: Boolean</div>
<div class="line">}</div>
</div><!-- fragment --><p></code></p>
<p><code></code></p>
<h3><a class="anchor" id="autotoc_md8796"></a>
&lt;strong&gt;Promise Rejection&lt;/strong&gt;</h3>
<p><code> An error object indicating what went wrong.</code></p>
<p><code>The <code>headers</code> property will contain the HTTP headers of the response.</code></p>
<p><code>If the action was denied because an OTP is required then <code>code</code> will be set to <code>EOTP</code>.</code></p>
<p><code>If the action was denied because it came from an IP address that this action on this account isn't allowed from then the <code>code</code> will be set to <code>EAUTHIP</code>.</code></p>
<p><code>Otherwise the code will be the HTTP response code.</code></p>
<p><code></code></p>
<h2><a class="anchor" id="autotoc_md8797"></a>
&lt;a name="opts"&gt;&lt;/a&gt; options objects</h2>
<p><code> The various API functions accept an optional <code>opts</code> object as a final argument. This opts object can either be a regular Object, or a <a href="https://npm.im/figgy-pudding"><code>figgy-pudding</code></a> options object instance.</code></p>
<p><code>Unless otherwise noted, the options accepted are the same as the <a href="https://www.npmjs.com/package/npm-registry-fetch#fetch-opts"><code>npm-registry-fetch</code> options</a>.</code></p>
<p><code>Of particular note are <code>opts.registry</code>, and the auth-related options:</code></p>
<p><code></p><ul>
<li><code>opts.token</code> - used for Bearer auth</li>
<li><code>opts.username</code> and <code>opts.password</code> - used for Basic auth</li>
<li><code>opts.otp</code> - the 2fa OTP token</li>
</ul>
<p></code></p>
<p><code></code></p>
<h1><a class="anchor" id="autotoc_md8798"></a>
&lt;a name="logging"&gt;&lt;/a&gt; Logging</h1>
<p><code> This modules logs by emitting <code>log</code> events on the global <code>process</code> object. These events look like this:</code></p>
<p><code></p><div class="fragment"><div class="line">process.emit(&#39;log&#39;, &#39;loglevel&#39;, &#39;feature&#39;, &#39;message part 1&#39;, &#39;part 2&#39;, &#39;part 3&#39;, &#39;etc&#39;)</div>
</div><!-- fragment --><p></code></p>
<p><code><code>loglevel</code> can be one of: <code>error</code>, <code>warn</code>, <code>notice</code>, <code>http</code>, <code>timing</code>, <code>info</code>, <code>verbose</code>, and <code>silly</code>.</code></p>
<p><code><code>feature</code> is any brief string that describes the component doing the logging.</code></p>
<p><code>The remaining arguments are evaluated like <code>console.log</code> and joined together with spaces.</code></p>
<p><code>A real world example of this is:</code></p>
<p><code></p><div class="fragment"><div class="line">process.emit(&#39;log&#39;, &#39;http&#39;, &#39;request&#39;, &#39;→&#39;, conf.method || &#39;GET&#39;, conf.target)</div>
</div><!-- fragment --><p></code></p>
<p><code>To handle the log events, you would do something like this:</code></p>
<p><code></p><div class="fragment"><div class="line">const log = require(&#39;npmlog&#39;)</div>
<div class="line">process.on(&#39;log&#39;, function (level) {</div>
<div class="line">  return log[level].apply(log, [].slice.call(arguments, 1))</div>
<div class="line">})</div>
</div><!-- fragment --><p> </code></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
