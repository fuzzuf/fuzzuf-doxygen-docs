<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fuzzuf: vm2 &lt;a href=&quot;https://www.npmjs.com/package/vm2&quot;&gt;&lt;img src=&quot;https://img.shields.io/npm/v/vm2.svg?style=flat-square&quot; alt=&quot;NPM Version&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://www.npmjs.com/package/vm2&quot;&gt;&lt;img src=&quot;https://img.shields.io/npm/dm/vm2.svg?style=flat-square&quot; alt=&quot;NPM Downloads&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;http://packagequality.com/#?package=vm2&quot;&gt;&lt;img src=&quot;http://npm.packagequality.com/shield/vm2.svg?style=flat-square&quot; alt=&quot;Package Quality&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://github.com/patriksimek/vm2/actions/workflows/node-test.yml&quot;&gt;&lt;img src=&quot;https://github.com/patriksimek/vm2/actions/workflows/node-test.yml/badge.svg&quot; alt=&quot;Node.js CI&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://snyk.io/test/github/patriksimek/vm2&quot;&gt;&lt;img src=&quot;https://snyk.io/test/github/patriksimek/vm2/badge.svg&quot; alt=&quot;Known Vulnerabilities&quot;/&gt;&lt;/a&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fuzzuf
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">vm2 <a href="https://www.npmjs.com/package/vm2"><object type="image/svg+xml" data="https://img.shields.io/npm/v/vm2.svg?style=flat-square" style="pointer-events: none;">NPM Version</object></a> <a href="https://www.npmjs.com/package/vm2"><object type="image/svg+xml" data="https://img.shields.io/npm/dm/vm2.svg?style=flat-square" style="pointer-events: none;">NPM Downloads</object></a> <a href="http://packagequality.com/#?package=vm2"><object type="image/svg+xml" data="http://npm.packagequality.com/shield/vm2.svg?style=flat-square" style="pointer-events: none;">Package Quality</object></a> <a href="https://github.com/patriksimek/vm2/actions/workflows/node-test.yml"><object type="image/svg+xml" data="https://github.com/patriksimek/vm2/actions/workflows/node-test.yml/badge.svg" style="pointer-events: none;">Node.js CI</object></a> <a href="https://snyk.io/test/github/patriksimek/vm2"><object type="image/svg+xml" data="https://snyk.io/test/github/patriksimek/vm2/badge.svg" style="pointer-events: none;">Known Vulnerabilities</object></a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>vm2 is a sandbox that can run untrusted code with whitelisted Node's built-in modules. Securely!</p>
<h1><a class="anchor" id="autotoc_md2665"></a>
Features</h1>
<ul>
<li>Runs untrusted code securely in a single process with your code side by side</li>
<li>Full control over the sandbox's console output</li>
<li>The sandbox has limited access to the process's methods</li>
<li>It is possible to require modules (built-in and external) from the sandbox</li>
<li>You can limit access to certain (or all) built-in modules</li>
<li>You can securely call methods and exchange data and callbacks between sandboxes</li>
<li>Is immune to all known methods of attacks</li>
<li>Transpiler support</li>
</ul>
<h1><a class="anchor" id="autotoc_md2666"></a>
How does it work</h1>
<ul>
<li>It uses the internal VM module to create a secure context.</li>
<li>It uses <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxies</a> to prevent escaping from the sandbox.</li>
<li>It overrides the built-in require to control access to modules.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2667"></a>
What is the difference between Node's vm and vm2?</h1>
<p>Try it yourself:</p>
<div class="fragment"><div class="line">const vm = require(&#39;vm&#39;);</div>
<div class="line">vm.runInNewContext(&#39;this.constructor.constructor(&quot;return process&quot;)().exit()&#39;);</div>
<div class="line">console.log(&#39;Never gets executed.&#39;);</div>
</div><!-- fragment --><div class="fragment"><div class="line">const {VM} = require(&#39;vm2&#39;);</div>
<div class="line">new VM().run(&#39;this.constructor.constructor(&quot;return process&quot;)().exit()&#39;);</div>
<div class="line">// Throws ReferenceError: process is not defined</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2668"></a>
Installation</h1>
<p><b>IMPORTANT</b>: VM2 requires Node.js 6 or newer.</p>
<div class="fragment"><div class="line">npm install vm2</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2669"></a>
Quick Example</h1>
<div class="fragment"><div class="line">const {VM} = require(&#39;vm2&#39;);</div>
<div class="line">const vm = new VM();</div>
<div class="line"> </div>
<div class="line">vm.run(`process.exit()`); // TypeError: process.exit is not a function</div>
</div><!-- fragment --><p>``&lsquo;js const {NodeVM} = require('vm2&rsquo;); const vm = new NodeVM({ require: { external: true, root: './' } });</p>
<p>vm.run(&lsquo; var request = require('request&rsquo;); request('<a href="http://www.google.com',">http://www.google.com',</a> function (error, response, body) { console.error(error); if (!error &amp;&amp; response.statusCode == 200) { console.log(body); // Show the HTML for the Google homepage. } }); &lsquo;, 'vm.js&rsquo;); </p><div class="fragment"><div class="line">## Documentation</div>
<div class="line"> </div>
<div class="line">* [VM](#vm)</div>
<div class="line">* [NodeVM](#nodevm)</div>
<div class="line">* [VMScript](#vmscript)</div>
<div class="line">* [Error handling](#error-handling)</div>
<div class="line">* [Debugging a sandboxed code](#debugging-a-sandboxed-code)</div>
<div class="line">* [Read-only objects](#read-only-objects-experimental)</div>
<div class="line">* [Protected objects](#protected-objects-experimental)</div>
<div class="line">* [Cross-sandbox relationships](#cross-sandbox-relationships)</div>
<div class="line">* [CLI](#cli)</div>
<div class="line">* [2.x to 3.x changes](https://github.com/patriksimek/vm2/wiki/2.x-to-3.x-changes)</div>
<div class="line">* [1.x and 2.x docs](https://github.com/patriksimek/vm2/wiki/1.x-and-2.x-docs)</div>
<div class="line">* [Contributing](https://github.com/patriksimek/vm2/wiki/Contributing)</div>
<div class="line"> </div>
<div class="line">## VM</div>
<div class="line"> </div>
<div class="line">VM is a simple sandbox to synchronously run untrusted code without the `require` feature. Only JavaScript built-in objects and Node&#39;s `Buffer` are available. Scheduling functions (`setInterval`, `setTimeout` and `setImmediate`) are not available by default.</div>
<div class="line"> </div>
<div class="line">**Options:**</div>
<div class="line"> </div>
<div class="line">* `timeout` - Script timeout in milliseconds. **WARNING**: You might want to use this option together with `allowAsync=false`. Further, operating on returned objects from the sandbox can run arbitrary code and circumvent the timeout. One should test if the returned object is a primitive with `typeof` and fully discard it (doing logging or creating error messages with such an object might also run arbitrary code again) in the other case.</div>
<div class="line">* `sandbox` - VM&#39;s global object.</div>
<div class="line">* `compiler` - `javascript` (default) or `coffeescript` or custom compiler function. The library expects you to have coffee-script pre-installed if the compiler is set to `coffeescript`.</div>
<div class="line">* `eval` - If set to `false` any calls to `eval` or function constructors (`Function`, `GeneratorFunction`, etc.) will throw an `EvalError` (default: `true`).</div>
<div class="line">* `wasm` -  If set to `false` any attempt to compile a WebAssembly module will throw a `WebAssembly.CompileError` (default: `true`).</div>
<div class="line">* `allowAsync` - If set to `false` any attempt to run code using `async` will throw a `VMError` (default: `true`).</div>
<div class="line"> </div>
<div class="line">**IMPORTANT**: Timeout is only effective on synchronous code that you run through `run`. Timeout does **NOT** work on any method returned by VM. There are some situations when timeout doesn&#39;t work - see [#244](https://github.com/patriksimek/vm2/pull/244).</div>
<div class="line"> </div>
<div class="line">```js</div>
<div class="line">const {VM} = require(&#39;vm2&#39;);</div>
<div class="line"> </div>
<div class="line">const vm = new VM({</div>
<div class="line">    timeout: 1000,</div>
<div class="line">    allowAsync: false,</div>
<div class="line">    sandbox: {}</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">vm.run(&#39;process.exit()&#39;); // throws ReferenceError: process is not defined</div>
</div><!-- fragment --><p>You can also retrieve values from VM.</p>
<div class="fragment"><div class="line">let number = vm.run(&#39;1337&#39;); // returns 1337</div>
</div><!-- fragment --><p><b>TIP</b>: See tests for more usage examples.</p>
<h1><a class="anchor" id="autotoc_md2670"></a>
NodeVM</h1>
<p>Unlike <code>VM</code>, <code>NodeVM</code> allows you to require modules in the same way that you would in the regular Node's context.</p>
<p><b>Options:</b></p>
<ul>
<li><code>console</code> - <code>inherit</code> to enable console, <code>redirect</code> to redirect to events, <code>off</code> to disable console (default: <code>inherit</code>).</li>
<li><code>sandbox</code> - VM's global object.</li>
<li><code>compiler</code> - <code>javascript</code> (default) or <code>coffeescript</code> or custom compiler function (which receives the code, and it's file path). The library expects you to have coffee-script pre-installed if the compiler is set to <code>coffeescript</code>.</li>
<li><code>eval</code> - If set to <code>false</code> any calls to <code>eval</code> or function constructors (<code>Function</code>, <code>GeneratorFunction</code>, etc.) will throw an <code>EvalError</code> (default: <code>true</code>).</li>
<li><code>wasm</code> - If set to <code>false</code> any attempt to compile a WebAssembly module will throw a <code>WebAssembly.CompileError</code> (default: <code>true</code>).</li>
<li><code>sourceExtensions</code> - Array of file extensions to treat as source code (default: &lsquo;['js&rsquo;]<code>). *</code>require<code>-</code>true<code>, an object or a Resolver to enable</code>require<code>method (default:</code>false<code>). *</code>require.external&lt;tt&gt;- Values can betrue<code>, an array of allowed external modules, or an object (default:</code>false<code>). All paths matching</code>/node_modules/${any_allowed_external_module}/(?!/node_modules/)<code>are allowed to be required. *</code>require.external.modules&lt;tt&gt;- Array of allowed external modules. Also supports wildcards, so specifying['@scope/*-ver-??]<code>, for instance, will allow using all modules having a name of the form</code>@scope/something-ver-aa<code>,</code>@scope/other-ver-11<code>, etc. The</code>*<code>wildcard does not match path separators. *</code>require.external.transitive&lt;tt&gt;- Boolean which indicates if transitive dependencies of external modules are allowed (default:false<code>). **WARNING**: When a module is required transitively, any module is then able to require it normally, even if this was not possible before it was loaded. *</code>require.builtin&lt;tt&gt;- Array of allowed built-in modules, accepts ["\*"] for all (default: none). **WARNING**: "\*" can be dangerous as new built-ins can be added. *require.root&lt;tt&gt;- Restricted path(s) where local modules can be required (default: every path). *require.mock&lt;tt&gt;- Collection of mock modules (both external or built-in). *require.context&lt;tt&gt;-host&lt;tt&gt;(default) to require modules in the host and proxy them into the sandbox.sandbox<code>to load, compile, and require modules in the sandbox.</code>callback(moduleFilename, ext)<code>to dynamically choose a context per module. The default will be sandbox is nothing is specified. Except for</code>events<code>, built-in modules are always required in the host and proxied into the sandbox. *</code>require.import&lt;tt&gt;- An array of modules to be loaded into NodeVM on start. *require.resolve&lt;tt&gt;- An additional lookup function in case a module wasn't found in one of the traditional node lookup paths. *require.customRequire&lt;tt&gt;- Use instead of therequire<code>function to load modules from the host. *</code>require.strict&lt;tt&gt;-false<code>to not force strict mode on modules loaded by require (default:</code>true<code>). *</code>require.fs&lt;tt&gt;- Custom file system implementation. *nesting<code>- **WARNING**: Allowing this is a security risk as scripts can create a NodeVM which can require any host module.</code>true<code>to enable VMs nesting (default:</code>false<code>). *</code>wrapper<code>-</code>commonjs&lt;tt&gt;(default) to wrap script into CommonJS wrapper,none<code>to retrieve value returned by the script. *</code>argv<code>- Array to be passed to</code>process.argv&lt;tt&gt;. *env<code>- Object to be passed to</code>process.env&lt;tt&gt;. *strict<code>-</code>true<code>to loaded modules in strict mode (default:</code>false`).</li>
</ul>
<p><b>IMPORTANT</b>: Timeout is not effective for NodeVM so it is not immune to <code>while (true) {}</code> or similar evil.</p>
<p><b>REMEMBER</b>: The more modules you allow, the more fragile your sandbox becomes.</p>
<div class="fragment"><div class="line">const {NodeVM} = require(&#39;vm2&#39;);</div>
<div class="line"> </div>
<div class="line">const vm = new NodeVM({</div>
<div class="line">    console: &#39;inherit&#39;,</div>
<div class="line">    sandbox: {},</div>
<div class="line">    require: {</div>
<div class="line">        external: true,</div>
<div class="line">        builtin: [&#39;fs&#39;, &#39;path&#39;],</div>
<div class="line">        root: &#39;./&#39;,</div>
<div class="line">        mock: {</div>
<div class="line">            fs: {</div>
<div class="line">                readFileSync: () =&gt; &#39;Nice try!&#39;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">// Sync</div>
<div class="line"> </div>
<div class="line">let functionInSandbox = vm.run(&#39;module.exports = function(who) { console.log(&quot;hello &quot;+ who); }&#39;);</div>
<div class="line">functionInSandbox(&#39;world&#39;);</div>
<div class="line"> </div>
<div class="line">// Async</div>
<div class="line"> </div>
<div class="line">let functionWithCallbackInSandbox = vm.run(&#39;module.exports = function(who, callback) { callback(&quot;hello &quot;+ who); }&#39;);</div>
<div class="line">functionWithCallbackInSandbox(&#39;world&#39;, (greeting) =&gt; {</div>
<div class="line">    console.log(greeting);</div>
<div class="line">});</div>
</div><!-- fragment --><p>When <code>wrapper</code> is set to <code>none</code>, <code>NodeVM</code> behaves more like <code>VM</code> for synchronous code.</p>
<div class="fragment"><div class="line">assert.ok(vm.run(&#39;return true&#39;) === true);</div>
</div><!-- fragment --><p><b>TIP</b>: See tests for more usage examples.</p>
<h2><a class="anchor" id="autotoc_md2671"></a>
Loading modules by relative path</h2>
<p>To load modules by relative path, you must pass the full path of the script you're running as a second argument to vm's <code>run</code> method if the script is a string. The filename is then displayed in any stack traces generated by the script.</p>
<div class="fragment"><div class="line">vm.run(&#39;require(&quot;foobar&quot;)&#39;, &#39;/data/myvmscript.js&#39;);</div>
</div><!-- fragment --><p>If the script you are running is a VMScript, the path is given in the VMScript constructor.</p>
<div class="fragment"><div class="line">const script = new VMScript(&#39;require(&quot;foobar&quot;)&#39;, {filename: &#39;/data/myvmscript.js&#39;});</div>
<div class="line">vm.run(script);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2672"></a>
Resolver</h2>
<p>A resolver can be created via <code>makeResolverFromLegacyOptions</code> and be used for multiple <code>NodeVM</code> instances allowing to share compiled module code potentially speeding up load times. The first example of <code>NodeVM</code> can be rewritten using <code>makeResolverFromLegacyOptions</code> as follows.</p>
<div class="fragment"><div class="line">const resolver = makeResolverFromLegacyOptions({</div>
<div class="line">    external: true,</div>
<div class="line">    builtin: [&#39;fs&#39;, &#39;path&#39;],</div>
<div class="line">    root: &#39;./&#39;,</div>
<div class="line">    mock: {</div>
<div class="line">        fs: {</div>
<div class="line">            readFileSync: () =&gt; &#39;Nice try!&#39;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">});</div>
<div class="line">const vm = new NodeVM({</div>
<div class="line">    console: &#39;inherit&#39;,</div>
<div class="line">    sandbox: {},</div>
<div class="line">    require: resolver</div>
<div class="line">});</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2673"></a>
VMScript</h1>
<p>You can increase performance by using precompiled scripts. The precompiled VMScript can be run multiple times. It is important to note that the code is not bound to any VM (context); rather, it is bound before each run, just for that run.</p>
<div class="fragment"><div class="line">const {VM, VMScript} = require(&#39;vm2&#39;);</div>
<div class="line"> </div>
<div class="line">const vm = new VM();</div>
<div class="line">const script = new VMScript(&#39;Math.random()&#39;);</div>
<div class="line">console.log(vm.run(script));</div>
<div class="line">console.log(vm.run(script));</div>
</div><!-- fragment --><p>It works for both <code>VM</code> and <code>NodeVM</code>.</p>
<div class="fragment"><div class="line">const {NodeVM, VMScript} = require(&#39;vm2&#39;);</div>
<div class="line"> </div>
<div class="line">const vm = new NodeVM();</div>
<div class="line">const script = new VMScript(&#39;module.exports = Math.random()&#39;);</div>
<div class="line">console.log(vm.run(script));</div>
<div class="line">console.log(vm.run(script));</div>
</div><!-- fragment --><p>Code is compiled automatically the first time it runs. One can compile the code anytime with <code>script.compile()</code>. Once the code is compiled, the method has no effect.</p>
<h1><a class="anchor" id="autotoc_md2674"></a>
Error handling</h1>
<p>Errors in code compilation and synchronous code execution can be handled by <code>try-catch</code>. Errors in asynchronous code execution can be handled by attaching <code>uncaughtException</code> event handler to Node's <code>process</code>.</p>
<div class="fragment"><div class="line">try {</div>
<div class="line">    var script = new VMScript(&#39;Math.random()&#39;).compile();</div>
<div class="line">} catch (err) {</div>
<div class="line">    console.error(&#39;Failed to compile script.&#39;, err);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">try {</div>
<div class="line">    vm.run(script);</div>
<div class="line">} catch (err) {</div>
<div class="line">    console.error(&#39;Failed to execute script.&#39;, err);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">process.on(&#39;uncaughtException&#39;, (err) =&gt; {</div>
<div class="line">    console.error(&#39;Asynchronous error caught.&#39;, err);</div>
<div class="line">});</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2675"></a>
Debugging a sandboxed code</h1>
<p>You can debug or inspect code running in the sandbox as if it was running in a normal process.</p>
<ul>
<li>You can use breakpoints (which requires you to specify a script file name)</li>
<li>You can use <code>debugger</code> keyword.</li>
<li>You can use step-in to step inside the code running in the sandbox.</li>
</ul>
<h2><a class="anchor" id="autotoc_md2676"></a>
Example</h2>
<p>/tmp/main.js:</p>
<div class="fragment"><div class="line">const {VM, VMScript} = require(&#39;.&#39;);</div>
<div class="line">const fs = require(&#39;fs&#39;);</div>
<div class="line">const file = `${__dirname}/sandbox.js`;</div>
<div class="line"> </div>
<div class="line">// By providing a file name as second argument you enable breakpoints</div>
<div class="line">const script = new VMScript(fs.readFileSync(file), file);</div>
<div class="line"> </div>
<div class="line">new VM().run(script);</div>
</div><!-- fragment --><p>/tmp/sandbox.js</p>
<div class="fragment"><div class="line">const foo = &#39;ahoj&#39;;</div>
<div class="line"> </div>
<div class="line">// The debugger keyword works just fine everywhere.</div>
<div class="line">// Even without specifying a file name to the VMScript object.</div>
<div class="line">debugger;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2677"></a>
Read-only objects (experimental)</h1>
<p>To prevent sandboxed scripts from adding, changing, or deleting properties from the proxied objects, you can use <code>freeze</code> methods to make the object read-only. This is only effective inside VM. Frozen objects are affected deeply. Primitive types cannot be frozen.</p>
<p><b>Example without using <code>freeze</code>:</b></p>
<div class="fragment"><div class="line">const util = {</div>
<div class="line">    add: (a, b) =&gt; a + b</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">const vm = new VM({</div>
<div class="line">    sandbox: {util}</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">vm.run(&#39;util.add = (a, b) =&gt; a - b&#39;);</div>
<div class="line">console.log(util.add(1, 1)); // returns 0</div>
</div><!-- fragment --><p><b>Example with using <code>freeze</code>:</b></p>
<div class="fragment"><div class="line">const vm = new VM(); // Objects specified in the sandbox cannot be frozen.</div>
<div class="line">vm.freeze(util, &#39;util&#39;); // Second argument adds object to global.</div>
<div class="line"> </div>
<div class="line">vm.run(&#39;util.add = (a, b) =&gt; a - b&#39;); // Fails silently when not in strict mode.</div>
<div class="line">console.log(util.add(1, 1)); // returns 2</div>
</div><!-- fragment --><p><b>IMPORTANT:</b> It is not possible to freeze objects that have already been proxied to the VM.</p>
<h1><a class="anchor" id="autotoc_md2678"></a>
Protected objects (experimental)</h1>
<p>Unlike <code>freeze</code>, this method allows sandboxed scripts to add, change, or delete properties on objects, with one exception - it is not possible to attach functions. Sandboxed scripts are therefore not able to modify methods like <code>toJSON</code>, <code>toString</code> or <code>inspect</code>.</p>
<p><b>IMPORTANT:</b> It is not possible to protect objects that have already been proxied to the VM.</p>
<h1><a class="anchor" id="autotoc_md2679"></a>
Cross-sandbox relationships</h1>
<div class="fragment"><div class="line">const assert = require(&#39;assert&#39;);</div>
<div class="line">const {VM} = require(&#39;vm2&#39;);</div>
<div class="line"> </div>
<div class="line">const sandbox = {</div>
<div class="line">    object: new Object(),</div>
<div class="line">    func: new Function(),</div>
<div class="line">    buffer: new Buffer([0x01, 0x05])</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">const vm = new VM({sandbox});</div>
<div class="line"> </div>
<div class="line">assert.ok(vm.run(`object`) === sandbox.object);</div>
<div class="line">assert.ok(vm.run(`object instanceof Object`));</div>
<div class="line">assert.ok(vm.run(`object`) instanceof Object);</div>
<div class="line">assert.ok(vm.run(`object.__proto__ === Object.prototype`));</div>
<div class="line">assert.ok(vm.run(`object`).__proto__ === Object.prototype);</div>
<div class="line"> </div>
<div class="line">assert.ok(vm.run(`func`) === sandbox.func);</div>
<div class="line">assert.ok(vm.run(`func instanceof Function`));</div>
<div class="line">assert.ok(vm.run(`func`) instanceof Function);</div>
<div class="line">assert.ok(vm.run(`func.__proto__ === Function.prototype`));</div>
<div class="line">assert.ok(vm.run(`func`).__proto__ === Function.prototype);</div>
<div class="line"> </div>
<div class="line">assert.ok(vm.run(`new func() instanceof func`));</div>
<div class="line">assert.ok(vm.run(`new func()`) instanceof sandbox.func);</div>
<div class="line">assert.ok(vm.run(`new func().__proto__ === func.prototype`));</div>
<div class="line">assert.ok(vm.run(`new func()`).__proto__ === sandbox.func.prototype);</div>
<div class="line"> </div>
<div class="line">assert.ok(vm.run(`buffer`) === sandbox.buffer);</div>
<div class="line">assert.ok(vm.run(`buffer instanceof Buffer`));</div>
<div class="line">assert.ok(vm.run(`buffer`) instanceof Buffer);</div>
<div class="line">assert.ok(vm.run(`buffer.__proto__ === Buffer.prototype`));</div>
<div class="line">assert.ok(vm.run(`buffer`).__proto__ === Buffer.prototype);</div>
<div class="line">assert.ok(vm.run(`buffer.slice(0, 1) instanceof Buffer`));</div>
<div class="line">assert.ok(vm.run(`buffer.slice(0, 1)`) instanceof Buffer);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2680"></a>
CLI</h1>
<p>Before you can use vm2 in the command line, install it globally with <code>npm install vm2 -g</code>.</p>
<div class="fragment"><div class="line">vm2 ./script.js</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2681"></a>
Known Issues</h1>
<ul>
<li>It is not possible to define a class that extends a proxied class. This includes using a proxied class in <code>Object.create</code>.</li>
<li>Direct eval does not work.</li>
<li>Logging sandbox arrays will repeat the array part in the properties.</li>
<li>Source code transformations can result a different source string for a function.</li>
<li>There are ways to crash the node process from inside the sandbox.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2682"></a>
Deployment</h1>
<ol type="1">
<li>Update the <code>CHANGELOG.md</code></li>
<li>Update the <code>package.json</code> version number</li>
<li>Commit the changes</li>
<li>Run <code>npm publish</code></li>
</ol>
<h1><a class="anchor" id="autotoc_md2683"></a>
Sponsors</h1>
<p><a href="https://www.integromat.com"><img src="https://static.integromat.com/logo/45_text.png" alt="Integromat" class="inline"/></a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
