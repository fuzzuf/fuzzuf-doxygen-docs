<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fuzzuf: libFuzzer Implementation in fuzzuf</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fuzzuf
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">libFuzzer Implementation in fuzzuf </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This section describes the implementation of libFuzzer in fuzzuf.</p>
<h1><a class="anchor" id="autotoc_md60"></a>
How to Construct the Standard libFuzzer</h1>
<p>The fuzzer corresponding to <code>Fuzzer::Loop()</code> of the original libFuzzer is <code><a class="el" href="namespacefuzzuf_1_1algorithm_1_1libfuzzer.html#a01db1b982f4768736364d7f423db54f2">createRunone()</a></code> in <a href="/include/fuzzuf/algorithms/libfuzzer/create.hpp">include/fuzzuf/algorithms/libfuzzer/create.hpp</a>. You can use the libFuzzer implementation in fuzzuf by using this function when you use it as a standard libFuzzer.</p>
<h1><a class="anchor" id="autotoc_md61"></a>
HierarFlow Nodes for libFuzzer Implementation</h1>
<p>fuzzuf has the following nodes to represent libFuzzer in HierarFlow. For more details about each node, refer to the comments in the source code or the documentation generated by Doxygen.</p>
<h2><a class="anchor" id="autotoc_md62"></a>
Mutator Nodes</h2>
<ul>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/mutation/erase_bytes.hpp">EraseBytes</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/mutation/insert_byte.hpp">InsertByte</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/mutation/insert_repeated_bytes.hpp">InsertRepeatedBytes</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/mutation/change_byte.hpp">ChangeByte</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/mutation/change_bit.hpp">ChangeBit</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/mutation/shuffle_bytes.hpp">ShuffleBytes</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/mutation/change_ascii_integer.hpp">ChangeASCIIInteger</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/mutation/change_binary_integer.hpp">ChangeBinaryInteger</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/mutation/copy_part.hpp">CopyPart</a><ul>
<li>CopyPartOf</li>
<li>InsertPartOf</li>
</ul>
</li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/mutation/crossover.hpp">CrossOver</a><ul>
<li>CrossOver</li>
<li>CopyPartOf</li>
<li>InsertPartOf</li>
</ul>
</li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/mutation/dictionary.hpp">Dictionary</a><ul>
<li>Dictionary</li>
<li><a class="el" href="classUpdateDictionary.html" title="Add dictionary history entries to the dictionary specified by the Path. libFuzzer has &quot;Parsistent Aut...">UpdateDictionary</a></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md63"></a>
Control Nodes</h2>
<p>The control node performs the control necessary to construct the libFuzzer in HierarFlow.</p>
<ul>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/for_each.hpp">ForEach</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/if_new_coverage.hpp">IfNewCoverage</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/random_call.hpp">RandomCall</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/repeat.hpp">Repeat</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/repeat_until_new_coverage.hpp">RepeatUntilNewCoverage</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/repeat_until_mutated.hpp">RepeatUntilMutated</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/do_nothing.hpp">DoNothing</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/assign.hpp">Assign</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/append.hpp">Append</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md64"></a>
Execute Node</h2>
<p>The <a class="el" href="classExecute.html" title="Run target with input specified by the Path, and acquire coverage, outputs, execution result to the v...">Execute</a> node has an Executor, which executes the target with input values and gets coverage, standard output, and execution results.</p>
<ul>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/execute.hpp">Execute</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md65"></a>
Feedback Node</h2>
<p>Feedback nodes are responsible for selecting execution results to be added to the corpus.</p>
<ul>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/collect_features.hpp">CollectFeatures</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/add_to_corpus.hpp">AddToCorpus</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/add_to_solution.hpp">AddToSolutions</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/add_to_solution.hpp">UpdateDistribution</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/choose_random_seed.hpp">ChooseRandomSeed</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md66"></a>
Debug Nodes</h2>
<p>Debug nodes make it easy to debug fuzzers in HierarFlow.</p>
<ul>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/dump.hpp">Dump</a></li>
<li><a href="/include/fuzzuf/algorithms/libfuzzer/hierarflow/print_status_for_new_unit.hpp">PrintStatusForNewUnit</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md67"></a>
Unimplemented Features</h1>
<p>Some features of libFuzzer are unimplemented in fuzzuf:</p>
<h2><a class="anchor" id="autotoc_md68"></a>
Mutator</h2>
<h3><a class="anchor" id="autotoc_md69"></a>
Mutate_AddWordFromTORC (CMP)</h3>
<p>The original libFuzzer adds this mutator when option CMP is enabled. It records the information of branching by comparison operations and performs mutation. If the compiler has the <code>-fsanitize-coverage=trace-cmp</code> option, the compiler will instrument the executable to record the comparison target and operator type at runtime when the executable branches on a comparison operation. CMP will look for a value in the input that is the same as the value used in the comparison and rewrites it so that the conditional branch goes into a different side. This mutation is based on the following idea: even if the input has the same value as the value used in the comparison, it does not guarantee the same value as the comparison target, but the fuzzer expects to change the branch direction with some probability. This mutator is unimplemented in fuzzuf because it does not support <code>trace-cmp</code> to get information about comparison operations.</p>
<h3><a class="anchor" id="autotoc_md70"></a>
Mutate_AddWordFromPersistentAutoDictionary</h3>
<p>libFuzzer has a dictionary that stores the values inserted by <code>Mutate_AddWordFromManualDictionary</code> and <code>Mutate_AddWordFromTORC</code> that led to the discovery of new coverage. Since CMP is unimplemented in fuzzuf, this mutator only stores input from <code>Mutate_AddWordFromManualDictionary</code>.</p>
<h3><a class="anchor" id="autotoc_md71"></a>
Custom Mutator</h3>
<p>libFuzzer provides CustomMutator and CustomCrossOver to add your mutators. fuzzuf does not provide nodes for these mutators because it is easier to add nodes by yourself than provide special nodes.</p>
<h2><a class="anchor" id="autotoc_md72"></a>
Corpus</h2>
<p>libFuzzer can persist the complete state of corpus and resume fuzzing. Still, the implementation of fuzzuf only persists the input values, so it cannot completely restore the previous state even if it resumes from the persistent information.</p>
<h2><a class="anchor" id="autotoc_md73"></a>
Feature</h2>
<h3><a class="anchor" id="autotoc_md74"></a>
Data Flow Trace</h3>
<p>Data Flow Trace uses a record of data movement obtained using LLVM's DataFlowSanitizer to determine which parts of the input values affect the branch. By masking the range of mutation based on this result, a fuzzer can concentrate on finding the input that exits a particular branch. However, the original implementation of libFuzzer does not use this information effectively to generate the mask. This feature is not implemented in fuzzuf because there is no way to get the information equivalent to DataFlowSanitizer similar to CMP.</p>
<h2><a class="anchor" id="autotoc_md75"></a>
Executor</h2>
<h3><a class="anchor" id="autotoc_md76"></a>
Avoiding Child Process Creation</h3>
<p>libFuzzer avoids the cost of creating child processes by linking the fuzzing target and the fuzzer into the same binary. Still, since there is no equivalent executor in fuzzuf, the implementation of fuzzuf creates child processes.</p>
<h3><a class="anchor" id="autotoc_md77"></a>
Support for Shared Libraries</h3>
<p>libFuzzer has a mechanism to collect and combine the edge coverage of both executable binaries and shared libraries linked to them. This feature is not implemented in fuzzuf because there is no way to get coverage from shared libraries.</p>
<h2><a class="anchor" id="autotoc_md78"></a>
Feedback</h2>
<h3><a class="anchor" id="autotoc_md79"></a>
Leak Sanitizer</h3>
<p>The original libFuzzer detects memory leaks. On the other hand, fuzzuf can treat this case as a failure if the target is compiled with Leak Sanitizer. Still, since the reason for the failure is abort, it is not possible to determine whether it was a memory leak or not, so fuzzuf cannot use the information of unreleased memory detection.</p>
<h3><a class="anchor" id="autotoc_md80"></a>
Stack Depth Tracing</h3>
<p>The original libFuzzer uses the stack-depth of LLVM's SanitizerCoverage to get the stack depth used by the target, but fuzzuf has no way to get the stack depth used, so it is unimplemented. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
